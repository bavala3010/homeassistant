###########################################
#  The following functions are not allowed by Audi Etron:
#    start_window_heating
#    start_preheater
#    start_charger


auto_status_verversen:
  alias: audi_refresh
  sequence:
  - service: audiconnect.refresh_data
    data:
      vin: WAUZZZGE6MB019131
  icon: hass:car
  mode: single
  
check_auto_op_slot:
  alias: check als auto echt niet op slot is
  sequence:
  - service: audiconnect.refresh_data
    data:
      vin: WAUZZZGE6MB019131
  - delay: 00:05:00
  - condition: state
    entity_id: lock.audi_e_tron_sportback_door_lock_2
    state: unlocked
  - service: notify.mobile_app_bart_s10
    data:
      message: ðŸš™ Auto niet op slot! (veeg omlaag voor acties)
      data:
        channel: Important
        tag: slot_auto
        color: red
        actions:
        - action: lock_car
          title: SLUIT AUTO


###########################
# auto climatisatie
###########################

auto_start_climatisatie_nu:
  alias: auto start climatisatie
  sequence:
  - service: timer.start
    data:
      duration: '1800'
    target:
      entity_id: timer.car_climatisation
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_climatisation
  - service: notify.bart_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 18000  # 1800 seconden = half uur
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - service: notify.madouce_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 180000  # half uur
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: stop_climatisation
  - service: notify.bart_phone
    data:
      message: Climatisatie auto gestopt
      data:
        tag: auto_verwarmen
        timeout: 6000  # 10 minuten
        actions:
        - action: URI
          title: meer info
          uri: /lovelace/e-tron
  - service: notify.madouce_phone
    data:
      message: Climatisatie auto gestopt
      data:
        tag: auto_verwarmen
        timeout: 6000  # 10 minuten
        actions:
        - action: URI
          title: meer info
          uri: /lovelace/e-tron

auto_start_climatisatie_30min:
  alias: auto start climatisatie na 30 min
  sequence:
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: timer.start
    data:
      duration: '1800'
    target:
      entity_id: timer.car_climatisation
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_climatisation
  - service: notify.bart_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 18000  # 1800 seconden = half uur
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - service: notify.madouce_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 180000  # half uur
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: stop_climatisation
  - service: notify.bart_phone
    data:
      message: Climatisatie auto gestopt
      data:
        tag: auto_verwarmen
        timeout: 6000  # 10 minuten
        actions:
        - action: URI
          title: meer info
          uri: /lovelace/e-tron
  - service: notify.madouce_phone
    data:
      message: Climatisatie auto gestopt
      data:
        tag: auto_verwarmen
        timeout: 6000  # 10 minuten
        actions:
        - action: URI
          title: meer info
          uri: /lovelace/e-tron

auto_start_climatisatie_60min:
  alias: auto start climatisatie na 60 min
  sequence:
  - delay:
      hours: 1
      minutes: 00
      seconds: 0
      milliseconds: 0
  - service: timer.start
    data:
      duration: '1800'
    target:
      entity_id: timer.car_climatisation
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_climatisation
  - service: notify.bart_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 18000  # 1800 seconden = half uur
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - service: notify.madouce_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 180000  # half uur
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: stop_climatisation
  - service: notify.bart_phone
    data:
      message: Climatisatie auto gestopt
      data:
        tag: auto_verwarmen
        timeout: 6000  # 10 minuten
        actions:
        - action: URI
          title: meer info
          uri: /lovelace/e-tron
  - service: notify.madouce_phone
    data:
      message: Climatisatie auto gestopt
      data:
        tag: auto_verwarmen
        timeout: 6000  # 10 minuten
        actions:
        - action: URI
          title: meer info
          uri: /lovelace/e-tron

auto_start_climatisatie_90min:
  alias: auto start climatisatie na 90 min
  sequence:
  - delay:
      hours: 1
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: timer.start
    data:
      duration: '1800'
    target:
      entity_id: timer.car_climatisation
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_climatisation
  - service: notify.bart_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 18000  # 1800 seconden = half uur
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - service: notify.madouce_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 180000  # half uur
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: stop_climatisation
  - service: notify.bart_phone
    data:
      message: Climatisatie auto gestopt
      data:
        tag: auto_verwarmen
        timeout: 6000  # 10 minuten
        actions:
        - action: URI
          title: meer info
          uri: /lovelace/e-tron
  - service: notify.madouce_phone
    data:
      message: Climatisatie auto gestopt
      data:
        timeout: 6000  # 10 minuten
        actions:
        - action: URI
          title: meer info
          uri: /lovelace/e-tron

auto_start_climatisatie_120min:
  alias: auto start climatisatie na 120 min
  sequence:
  - delay:
      hours: 2
      minutes: 0
      seconds: 0
      milliseconds: 0
  - service: timer.start
    data:
      duration: '1800'
    target:
      entity_id: timer.car_climatisation
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_climatisation
  - service: notify.bart_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 18000  # 1800 seconden = half uur
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - service: notify.madouce_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 180000  # half uur
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: stop_climatisation
  - service: notify.bart_phone
    data:
      message: Climatisatie auto gestopt
      data:
        tag: auto_verwarmen
        timeout: 6000  # 10 minuten
        actions:
        - action: URI
          title: meer info
          uri: /lovelace/e-tron
  - service: notify.madouce_phone
    data:
      message: Climatisatie auto gestopt
      data:
        tag: auto_verwarmen
        timeout: 6000  # 10 minuten
        actions:
        - action: URI
          title: meer info
          uri: /lovelace/e-tron

auto_start_climatisatie_150min:
  alias: auto start climatisatie na 150 min
  sequence:
  - delay:
      hours: 2
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: timer.start
    data:
      duration: '1800'
    target:
      entity_id: timer.car_climatisation
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_climatisation
  - service: notify.bart_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 18000  # 1800 seconden = half uur
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - service: notify.madouce_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 180000  # half uur
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: stop_climatisation
  - service: notify.bart_phone
    data:
      message: Climatisatie auto gestopt
      data:
        tag: auto_verwarmen
        timeout: 6000  # 10 minuten
        actions:
        - action: URI
          title: meer info
          uri: /lovelace/e-tron
  - service: notify.madouce_phone
    data:
      message: Climatisatie auto gestopt
      data:
        tag: auto_verwarmen
        timeout: 6000  # 10 minuten
        actions:
        - action: URI
          title: meer info
          uri: /lovelace/e-tron

auto_stop_climatisatie:
  alias: auto stop climatisatie
  sequence:
  - service: timer.cancel
    target:
      entity_id: timer.car_climatisation
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: stop_climatisation
  - service: script.turn_off
    target:
      entity_id: script.auto_start_climatisation
  - service: notify.bart_phone
    data:
      message: Climatisatie auto gestopt
      data:
        tag: auto_verwarmen
        timeout: 6000 # 10 minuten
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - service: notify.madouce_phone
    data:
      message: Climatisatie auto gestopt
      data:
        tag: auto_verwarmen
        timeout: 6000   # 10 minuten
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron


###########################
# auto laden
###########################

car_charging_set_smart_modus:
  alias: zet laadmodus op smart charging
  sequence:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.smart_charging_mode_timer

car_charging_set_direct_modus:
  alias: zet laadmodus op direct laden
  sequence:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.smart_charging_mode_direct

auto_start_laden_nu:
  alias: auto start laden nu
  sequence:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.smart_charging_mode_direct  
  - service: input_datetime.set_datetime
    target:
      entity_id: input_datetime.car_smart_charging_command_sent_time
    data:
      time: "{{ now().timestamp() | timestamp_custom('%H:%M') }}"
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.car_smart_charging_command_sent
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_charger

auto_start_laden_timer:
  alias: auto start laden timer
  sequence:
  - service: input_datetime.set_datetime
    target:
      entity_id: input_datetime.car_smart_charging_command_sent_time
    data:
      time: "{{ now().timestamp() | timestamp_custom('%H:%M') }}"
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.car_smart_charging_command_sent
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_timed_charger

auto_stop_laden:
  alias: auto stop laden
  sequence:
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: stop_charging
