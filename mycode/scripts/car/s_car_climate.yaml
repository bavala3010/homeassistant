###########################################
#  The following functions are not allowed by Audi Etron:
#    start_window_heating
#    start_preheater
#    start_charger


###########################
# auto climatisatie
###########################

auto_start_climatisatie_nu_google_home:
  alias: auto start climatisatie via Google Home
  sequence:
  - service: timer.start
    data:
      duration: '1800'
    target:
      entity_id: timer.car_climatisation
  - service: tts.edge_tts_say
    data:
      entity_id: media_player.living_speaker
      message: "De verwarming van de auto wordt ingeschakeld."      
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: start_climatisation
  - wait_template: "{{ is_state('sensor.audi_e_tron_sportback_climatisation_state', 'heating') }}"
  - service: tts.edge_tts_say
    data:
      entity_id: media_player.living_speaker
      message: "De auto is aan het verwarmen."
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: stop_climatisation
  - if:
      - condition: or
        conditions:
          - condition: state
            entity_id: binary_sensor.madouce_phone_connected_to_car_1
            state: "off"
          - condition: state
            entity_id: binary_sensor.bart_phone_connected_to_car_1
            state: "off"
    then:
      - service: notify.bart_madouce_phone
        data:
          message: Climatisatie auto gestopt
          data:
            tag: auto_verwarmen
            timeout: 6000  # 10 minuten
            actions:
            - action: URI
              title: meer info
              uri: /lovelace/e-tron
  mode: restart

auto_start_climatisatie_nu:
  alias: auto start climatisatie nu
  sequence:
  - service: timer.start
    data:
      duration: '1800'
    target:
      entity_id: timer.car_climatisation
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: start_climatisation
  - service: notify.bart_madouce_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 18000  # 1800 seconden = half uur
        actions:
        - action: URI
          title: meer info
          uri: /dashboard-car/e-tron
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: stop_climatisation
  - if:
      - condition: or
        conditions:
          - condition: state
            entity_id: binary_sensor.madouce_phone_connected_to_car_1
            state: "off"
          - condition: state
            entity_id: binary_sensor.bart_phone_connected_to_car_1
            state: "off"
    then:
      - service: notify.bart_madouce_phone
        data:
          message: Climatisatie auto gestopt
          data:
            tag: auto_verwarmen
            timeout: 6000  # 10 minuten
            actions:
            - action: URI
              title: meer info
              uri: /lovelace/e-tron


auto_start_climatisatie_30min:
  alias: auto start climatisatie na 30 min
  sequence:
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: timer.start
    data:
      duration: '1800'
    target:
      entity_id: timer.car_climatisation
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: start_climatisation
  - service: notify.bart_madouce_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 18000  # 1800 seconden = half uur
        actions:
        - action: URI
          title: meer info
          uri: /dashboard-car/e-tron
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: stop_climatisation
  - if:
      - condition: or
        conditions:
          - condition: state
            entity_id: binary_sensor.madouce_phone_connected_to_car_1
            state: "off"
          - condition: state
            entity_id: binary_sensor.bart_phone_connected_to_car_1
            state: "off"
    then:
      - service: notify.bart_madouce_phone
        data:
          message: Climatisatie auto gestopt
          data:
            tag: auto_verwarmen
            timeout: 6000  # 10 minuten
            actions:
            - action: URI
              title: meer info
              uri: /lovelace/e-tron

auto_start_climatisatie_60min:
  alias: auto start climatisatie na 60 min
  sequence:
  - delay:
      hours: 1
      minutes: 00
      seconds: 0
      milliseconds: 0
  - service: timer.start
    data:
      duration: '1800'
    target:
      entity_id: timer.car_climatisation
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: start_climatisation
  - service: notify.bart_madouce_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 18000  # 1800 seconden = half uur
        actions:
        - action: URI
          title: meer info
          uri: /dashboard-car/e-tron
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: stop_climatisation
  - if:
      - condition: or
        conditions:
          - condition: state
            entity_id: binary_sensor.madouce_phone_connected_to_car_1
            state: "off"
          - condition: state
            entity_id: binary_sensor.bart_phone_connected_to_car_1
            state: "off"
    then:
      - service: notify.bart_madouce_phone
        data:
          message: Climatisatie auto gestopt
          data:
            tag: auto_verwarmen
            timeout: 6000  # 10 minuten
            actions:
            - action: URI
              title: meer info
              uri: /lovelace/e-tron


auto_start_climatisatie_90min:
  alias: auto start climatisatie na 90 min
  sequence:
  - delay:
      hours: 1
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: timer.start
    data:
      duration: '1800'
    target:
      entity_id: timer.car_climatisation
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: start_climatisation
  - service: notify.bart_madouce_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 18000  # 1800 seconden = half uur
        actions:
        - action: URI
          title: meer info
          uri: /dashboard-car/e-tron
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: stop_climatisation
  - if:
      - condition: or
        conditions:
          - condition: state
            entity_id: binary_sensor.madouce_phone_connected_to_car_1
            state: "off"
          - condition: state
            entity_id: binary_sensor.bart_phone_connected_to_car_1
            state: "off"
    then:
      - service: notify.bart_madouce_phone
        data:
          message: Climatisatie auto gestopt
          data:
            tag: auto_verwarmen
            timeout: 6000  # 10 minuten
            actions:
            - action: URI
              title: meer info
              uri: /lovelace/e-tron


auto_start_climatisatie_120min:
  alias: auto start climatisatie na 120 min
  sequence:
  - delay:
      hours: 2
      minutes: 0
      seconds: 0
      milliseconds: 0
  - service: timer.start
    data:
      duration: '1800'
    target:
      entity_id: timer.car_climatisation
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: start_climatisation
  - service: notify.bart_madouce_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 18000  # 1800 seconden = half uur
        actions:
        - action: URI
          title: meer info
          uri: /dashboard-car/e-tron
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: stop_climatisation
  - if:
      - condition: or
        conditions:
          - condition: state
            entity_id: binary_sensor.madouce_phone_connected_to_car_1
            state: "off"
          - condition: state
            entity_id: binary_sensor.bart_phone_connected_to_car_1
            state: "off"
    then:
      - service: notify.bart_madouce_phone
        data:
          message: Climatisatie auto gestopt
          data:
            tag: auto_verwarmen
            timeout: 6000  # 10 minuten
            actions:
            - action: URI
              title: meer info
              uri: /lovelace/e-tron


auto_start_climatisatie_150min:
  alias: auto start climatisatie na 150 min
  sequence:
  - delay:
      hours: 2
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: timer.start
    data:
      duration: '1800'
    target:
      entity_id: timer.car_climatisation
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: start_climatisation
  - service: notify.bart_madouce_phone
    data:
      message: Climatisatie auto gestart
      data:
        tag: auto_verwarmen
        timeout: 18000  # 1800 seconden = half uur
        actions:
        - action: URI
          title: meer info
          uri: /dashboard-car/e-tron
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: stop_climatisation
  - if:
      - condition: or
        conditions:
          - condition: state
            entity_id: binary_sensor.madouce_phone_connected_to_car_1
            state: "off"
          - condition: state
            entity_id: binary_sensor.bart_phone_connected_to_car_1
            state: "off"
    then:
      - service: notify.bart_madouce_phone
        data:
          message: Climatisatie auto gestopt
          data:
            tag: auto_verwarmen
            timeout: 6000  # 10 minuten
            actions:
            - action: URI
              title: meer info
              uri: /lovelace/e-tron


auto_stop_climatisatie:
  alias: auto stop climatisatie
  sequence:
  - service: timer.cancel
    target:
      entity_id: timer.car_climatisation
  - service: audiconnect.execute_vehicle_action
    data:
      vin: !secret vin
      action: stop_climatisation
  - if:
      - condition: or
        conditions:
          - condition: state
            entity_id: binary_sensor.madouce_phone_connected_to_car_1
            state: "off"
          - condition: state
            entity_id: binary_sensor.bart_phone_connected_to_car_1
            state: "off"
    then:
      - service: notify.bart_madouce_phone
        data:
          message: Climatisatie auto gestopt
          data:
            tag: auto_verwarmen
            timeout: 6000  # 10 minuten
            actions:
            - action: URI
              title: meer info
              uri: /lovelace/e-tron
