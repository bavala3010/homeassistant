# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

# useful links
# https://pictogrammers.github.io/@mdi/font/5.3.45/
# https://materialdesignicons.com/
# https://emojidb.org/
# https://www.zapsplat.com/sound-effect-category/sirens-and-alarms/
# https://www.uuidgenerator.net/
# https://app.diagrams.net/
# https://demo.home-assistant.io/#/energy


discovery:

# Text to speech
tts:
  - platform: google_translate
    cache: false
    cache_dir: /tmp/tts
    time_memory: 300
    base_url: http://192.168.86.101:8123
    service_name: google_say
    language: 'nl'

group: !include groups.yaml
automation: !include automations.yaml
# script: !include scripts.yaml
# include all scripts from the subfolder called "scripts"

script: !include_dir_merge_named scripts
scene: !include scenes.yaml
google_assistant: !include google_assistant_integration.yaml

frontend:
  themes: !include_dir_merge_named themes

homeassistant:
  allowlist_external_dirs:
    - "/config"
### The following installs all package files, including lights, alarm, humidity etc.
  packages: !include_dir_named packages
  customize: !include customize.yaml
  
  external_url: http://bartland.duckdns.org

# secrets should not be mentioned in this file; it is automatic !
# secrets: !include secrets.yaml

influxdb:
  api_version: 2
  ssl: false
  host: 192.168.86.101
  port: 8086
  token: K2k46Gxxtwl83bqhKJs2M4CsoYECUccjMnxpIcvjqzg64Tkxk-QdF_QHq3IB4rtDHxZEABx3Q74YBZ6oFwHNyQ==
  organization: 30fed6985f8efca2
  bucket: home_assistant
  tags:
    source: HA
  tags_attributes:
    - friendly_name
  default_measurement: units
  exclude:
    entities:
      - zone.home
    domains:
      - persistent_notification
      - person
  include:
    domains:
      - sensor
      - binary_sensor
      - sun
    entities:
      - weather.home


# needed when using reverse proxy managers (eg. Nginx)
http:
  use_x_forwarded_for: true
  trusted_proxies:
    - 192.168.86.0/24 # the IP address of the proxy server
    - 172.20.0.0/24
    - 172.17.0.0/24
    - 172.0.0.0/24

#pi_hole:
#  host: 192.168.86.101:8081
#  name: pihole
#  api_key: !secret pihole_api_key
           
recorder:
  purge_keep_days: 31
  exclude:
    entities:
      - sensor.cpu
      - sensor.date
      - sensor.time
      - sensor.last_boot
      - sensor.low_battery
      - sun.sun
      - sensor.processor_use
      - sensor.disk_use_percent
      - binary_sensor.alunya_a71_apparaat_vergrendeld
      - binary_sensor.alunya_a71_applicatie_inactief
      - binary_sensor.alunya_a71_interactief
      - binary_sensor.sm_g975f_device_locked
      - binary_sensor.sm_g975f_interactive
    domains:
      - automation
      - camera
      - group
      - media_player
      - updater
      - persistent_notification
      - script
      - sun
      - switch
      - weather
      - zone
      - zwave

fan:
  - platform: xiaomi_miio_fan
    name: Xiaomi Smart Fan 3C
    host: 192.168.86.29
    token: !secret fan_3C_token
    
  - platform: xiaomi_miio_fan
    name: Xiaomi Smart Fan 1C
    host: 192.168.86.28
    token: !secret fan_1C_token
    
  - platform: xiaomi_miio_airpurifier
    name: Xiaomi Air Purifier 3H
    host: 192.168.86.250
    token: !secret purifier_3H_token
    model: zhimi.airpurifier.mb3

netatmo:
# create client_id and client_secret at https://dev.netatmo.com/apps
# Waarschoot
#  client_id: 60d72f7458da3d00f57f4fd5 
#  client_secret: cEP5HXSCw74AEey7KkpEFIBwrzO

# Eikenbos
  client_id: 60e3e87226bd613977210595
  client_secret: t3OJP8WvSQR538Wb1WpAXqARxfzq

alarm_control_panel:
  - platform: manual
    name: home_alarm
    code: !secret alarm_code
    code_arm_required: false
    arming_time: 60
    delay_time: 5
    trigger_time: 4
    disarmed:
      trigger_time: 0
    armed_home:
      arming_time: 0
      delay_time: 0

#String om bij te houden welke sensor het alarm triggert
input_text:
  trigger_source:
    name: Trigger Source

utility_meter:
  daily_energy:
    source: sensor.ty02820620a4cf12eb80b8_2
    cycle: daily
  monthly_energy:
    source: sensor.ty02820620a4cf12eb80b8_2
    cycle: monthly

sensor:
  - platform: version
  # The version sensor platform can display the current Home Assistant versions.
  
  - platform: thermal_comfort
    sensors:
      outside_thermal:
        friendly_name: outside
        temperature_sensor: sensor.temp_leuven24_wunderground
        humidity_sensor: sensor.humidity_leuven24_wunderground
      living_room_thermal:
        friendly_name: living room
        temperature_sensor: sensor.living_room_temperature
        humidity_sensor: sensor.living_room_humidity
      kamer_amilya_thermal:
        friendly_name: kamer Amilya
        temperature_sensor: sensor.kamer_amilya_temperature
        humidity_sensor: sensor.kamer_amilya_humidity
      veranda_thermal:
        friendly_name: veranda
        temperature_sensor: sensor.veranda_temperature
        humidity_sensor: sensor.veranda_humidity
      berging_thermal:
        friendly_name: berging
        temperature_sensor: sensor.berging_temperature
        humidity_sensor: sensor.berging_humidity
      gang_thermal:
        friendly_name: gang
        temperature_sensor: sensor.gang_temperature
        humidity_sensor: sensor.gang_humidity
      badkamer_thermal:
        friendly_name: badkamer
        temperature_sensor: sensor.badkamer_temperature
        humidity_sensor: sensor.badkamer_humidity
      kamer_alunya_thermal:
        friendly_name: kamer Alunya
        temperature_sensor: sensor.kamer_alunya_temperature
        humidity_sensor: sensor.kamer_alunya_humidity
      master_bedroom_thermal:
        friendly_name: master bedroom
        temperature_sensor: sensor.master_bedroom_temperature
        humidity_sensor: sensor.master_bedroom_humidity

  - platform: template
    sensors:
      xiaomi_air_purifier_air_quality_pm25:
        friendly_name: "Air quality (AQI) PM2.5"
        value_template: "{{ state_attr('fan.xiaomi_air_purifier_3h', 'aqi') }}"
        unit_of_measurement: "μg/m³"
        icon_template: "mdi:weather-fog"

  - platform: template
  # calculation of absolute humidity based on relative humidity and temperature
  # https://carnotcycle.wordpress.com/2012/08/04/how-to-convert-relative-humidity-to-absolute-humidity/
    sensors:
      gram_water_outside:
        friendly_name: 'gram vocht per m³ buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.temp_leuven24_wunderground')|float)) / (243.5 + (states('sensor.temp_leuven24_wunderground')|float)) ) * 6.112 * (states('sensor.humidity_leuven24_wunderground')|float) * 2.1674 ) / (273.15 + (states('sensor.temp_leuven24_wunderground')|float))) | round(1) }}

      gram_water_living_room:
        friendly_name: 'gram vocht per m³ in living'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.living_room_temperature')|float)) / (243.5 + (states('sensor.living_room_temperature')|float)) ) * 6.112 * (states('sensor.living_room_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.living_room_temperature')|float))) | round(1) }}

      gram_water_kamer_amilya:
        friendly_name: 'gram vocht per m³ in kamer Amilya'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.kamer_amilya_temperature')|float)) / (243.5 + (states('sensor.kamer_amilya_temperature')|float)) ) * 6.112 * (states('sensor.kamer_amilya_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.kamer_amilya_temperature')|float))) | round(1) }}

      gram_water_veranda:
        friendly_name: 'gram vocht per m³ in veranda'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.veranda_temperature')|float)) / (243.5 + (states('sensor.veranda_temperature')|float)) ) * 6.112 * (states('sensor.veranda_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.veranda_temperature')|float))) | round(1) }}

      gram_water_berging:
        friendly_name: 'gram vocht per m³ in berging'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.berging_temperature')|float)) / (243.5 + (states('sensor.berging_temperature')|float)) ) * 6.112 * (states('sensor.berging_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.kamer_amilya_temperature')|float))) | round(1) }}

      gram_water_badkamer:
        friendly_name: 'gram vocht per m³ in badkamer'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.badkamer_temperature')|float)) / (243.5 + (states('sensor.badkamer_temperature')|float)) ) * 6.112 * (states('sensor.badkamer_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.badkamer_temperature')|float))) | round(1) }}

      gram_water_gang:
        friendly_name: 'gram vocht per m³ in gang'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.gang_temperature')|float)) / (243.5 + (states('sensor.gang_temperature')|float)) ) * 6.112 * (states('sensor.gang_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.gang_temperature')|float))) | round(1) }}

      gram_water_kamer_alunya:
        friendly_name: 'gram vocht per m³ in kamer Alunya'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.kamer_alunya_temperature')|float)) / (243.5 + (states('sensor.kamer_alunya_temperature')|float)) ) * 6.112 * (states('sensor.kamer_alunya_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.kamer_alunya_temperature')|float))) | round(1) }}

      gram_water_master_bedroom:
        friendly_name: 'gram vocht per m³ in master bedroom'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.master_bedroom_temperature')|float)) / (243.5 + (states('sensor.master_bedroom_temperature')|float)) ) * 6.112 * (states('sensor.master_bedroom_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.master_bedroom_temperature')|float))) | round(1) }}

      gram_water_living_room_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in living room en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_living_room') | float) - (states('sensor.gram_water_outside')|float)) | round(1) }}"

      gram_water_kamer_amilya_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in kamer Amilya en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_kamer_amilya') | float) - (states('sensor.gram_water_outside')|float)) | round(1) }}"

      gram_water_veranda_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in veranda en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_veranda') | float) - (states('sensor.gram_water_outside')|float)) | round(1) }}"

      gram_water_berging_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in berging en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_berging') | float) - (states('sensor.gram_water_outside')|float)) | round(1) }}"

      gram_water_badkamer_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in badkamer en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_badkamer') | float) - (states('sensor.gram_water_outside')|float)) | round(1) }}"

      gram_water_gang_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in gang en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_gang') | float) - (states('sensor.gram_water_outside')|float)) | round(1) }}"

      gram_water_kamer_alunya_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in kamer Alunya en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_kamer_alunya') | float) - (states('sensor.gram_water_outside')|float)) | round(1) }}"

      gram_water_master_bedroom_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in master bedroom en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_master_bedroom') | float) - (states('sensor.gram_water_outside')|float)) | round(1) }}"

      outside_enthalpy:
        friendly_name: 'enthalpy buiten'
        unit_of_measurement: KJ/kg      
        value_template: "{{ (1.006 * (states('sensor.temp_leuven24_wunderground') | float) ) + ( (states('sensor.outside_thermal_absolutehumidity') | float / 1000) * (2501 + 1.84 * (states('sensor.temp_leuven24_wunderground') | float))) | round (2) }}" 

      veranda_enthalpy:
        friendly_name: 'enthalpy veranda'
        unit_of_measurement: KJ/kg      
        value_template: "{{ (1.006 * (states('sensor.veranda_temperature') | float) ) + ( (states('sensor.veranda_thermal_absolutehumidity') | float / 1000) * (2501 + 1.84 * (states('sensor.veranda_temperature') | float))) | round (2) }}" 

      master_bedroom_enthalpy:
        friendly_name: 'enthalpy master bedroom'
        unit_of_measurement: KJ/kg      
        value_template: "{{ (1.006 * (states('sensor.master_bedroom_temperature') | float) ) + ( (states('sensor.master_bedroom_thermal_absolutehumidity') | float / 1000) * (2501 + 1.84 * (states('sensor.master_bedroom_temperature') | float))) | round (2) }}" 

      car_range_per_10percent:
        friendly_name: 'range per 10%'
        unit_of_measurement: km
        value_template: "{{ (10 * states('sensor.audi_e_tron_sportback_55_primary_engine_range') | float / states('sensor.audi_e_tron_sportback_55_state_of_charge') | float ) | round (1) }}" 


# - platform: powercalc
#   entity_id: light.living
#   manufacturer: signify
#   model: LCT003
# - platform: powercalc
#   entity_id: light.amilya
# - platform: powercalc
#   entity_id: light.badkamer
# - platform: powercalc
#   entity_id: light.buiten


  - platform: history_stats
    name: TV_living_on_today
    entity_id: media_player.ue55ju7000
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0, minute=0, second=0) }}'
    end: '{{ now().replace(hour=23, minute=59, second=59) }}'

  - platform: history_stats
    name: ADS_TV_on_today
    entity_id: media_player.ads_tv
    state: 'playing'
    type: time
    start: '{{ now().replace(hour=0, minute=0, second=0) }}'
    end: '{{ now().replace(hour=23, minute=59, second=59) }}'

  - platform: history_stats
    name: master_bedroom_TV_on_today
    entity_id: media_player.master_bedroom_tv
    state: 'playing'
    type: time
    start: '{{ now().replace(hour=0, minute=0, second=0) }}'
    end: '{{ now().replace(hour=23, minute=59, second=59) }}'

  - platform: history_stats
    name: veranda_speaker_on_today
    entity_id: media_player.veranda_speaker
    state: 'playing'
    type: time
    start: '{{ now().replace(hour=0, minute=0, second=0) }}'
    end: '{{ now().replace(hour=23, minute=59, second=59) }}'
    
  - platform: history_stats
    name: living_light_links_on_today
    entity_id: light.living_links 
    state: on
    type: time
    start: '{{ now().replace(hour=0, minute=0, second=0) }}'
    end: '{{ now().replace(hour=23, minute=59, second=59) }}'

  - platform: history_stats
    name: living_light_rechts_on_today
    entity_id: light.living_rechts 
    state: on
    type: time
    start: '{{ now().replace(hour=0, minute=0, second=0) }}'
    end: '{{ now().replace(hour=23, minute=59, second=59) }}'

  - platform: history_stats
    name: veranda_light_on_today
    entity_id: light.veranda 
    state: on
    type: time
    start: '{{ now().replace(hour=0, minute=0, second=0) }}'
    end: '{{ now().replace(hour=23, minute=59, second=59) }}'

  - platform: afvalbeheer
    wastecollector: RecycleApp
    resources:
      - restafval
      - gft
      - papier
      - pmd
    postcode: 3010
    streetname: !secret streetname
    streetnumber: 25
    upcomingsensor: 1
    dateformat: '%d-%m-%Y'
    dateonly: 0
    name: ""
    nameprefix: 1
    builtinicons: 1
    dutch: 1

  - platform: buienalarm
    timeframe: 15
    name: buienalarm
    monitored_conditions:
      - temperature
      - precipitation
      - precipitation_forecast_average
      - precipitation_forecast_total
      - next_rain_forecast

  - platform: time_date
    display_options:
      - 'time'
      - 'date'

  - platform: min_max
    type: mean
    name: avg_outside_temp
    entity_ids:
      - sensor.buitensensor_vooraan_temperature
      - sensor.buitensensor_deur_temperature
      - sensor.temp_leuven24_wunderground
      - sensor.temp_leuven24_wunderground
      - sensor.temp_leuven24_wunderground
    round_digits: 2
    
  - platform: min_max
    type: mean
    name: avg_inside_humidity
    entity_ids:
      - sensor.living_room_humidity
      - sensor.kamer_amilya_humidity
      - sensor.veranda_humidity
      - sensor.gang_humidity
      - sensor.badkamer_humidity
      - sensor.kamer_alunya_humidity
      - sensor.master_bedroom_humidity
    round_digits: 0
    
  - platform: min_max
    type: mean
    name: avg_inside_temperature
    entity_ids:
      - sensor.living_room_temperature
      - sensor.kamer_amilya_temperature
      - sensor.veranda_temperature
      - sensor.gang_temperature
      - sensor.badkamer_temperature
      - sensor.kamer_alunya_temperature
      - sensor.master_bedroom_temperature
    round_digits: 1
    
    
  - platform: average
    name: 'Gemiddelde temperatuur beneden'
    entities:
      - sensor.living_room_temperature
      - sensor.gang_temperature
      - sensor.berging_temperature
    
  - platform: scrape
    resource: "https://www.wunderground.com/dashboard/pws/ILEUVE24"
#   resource: "https://www.wunderground.com/dashboard/pws/ILEUVE22"
    select: "#main-page-content > div > div > div > div:nth-child(2) > div > lib-tile-current-conditions > div > div.module__body > div > div.small-4.columns.text-left.conditions-temp > div.main-temp > lib-display-unit > span > span.wu-value.wu-value-to"
    name: temp_leuven24_wunderground
#   convert Farenheit to Celcius
    value_template: '{{ ((value | float -32) * (5/9)) |round(1) }}'
    scan_interval: 240
    unit_of_measurement: "°C"
    
  - platform: scrape
    resource: "https://www.wunderground.com/dashboard/pws/ILEUVE24"
#   resource: "https://www.wunderground.com/dashboard/pws/ILEUVE22"
    select: '<span _ngcontent-app-root-c173="">Offline</span>'
    name: online_status_leuven24_wunderground
    scan_interval: 600
    
  - platform: scrape
    resource: "https://www.wunderground.com/dashboard/pws/ILEUVE24"
#   resource: "https://www.wunderground.com/dashboard/pws/ILEUVE22"
    name: humidity_leuven24_wunderground
    select: "#main-page-content > div > div > div > div:nth-child(2) > div > lib-tile-current-conditions > div > div.module__body > div > div.weather__summary > div:nth-child(4) > div > div.weather__text > lib-display-unit > span > span.wu-value.wu-value-to"
    scan_interval: 240
    unit_of_measurement: "%"

  - platform: scrape  
    resource: "https://www.wunderground.com/dashboard/pws/ILEUVE24"
#   resource: "https://www.wunderground.com/dashboard/pws/ILEUVE22"
    # hoeveelheid huidige neerslag
    name: precip_rate_leuven24_wunderground
    select: "#main-page-content > div > div > div > div:nth-child(8) > div > lib-tile-precipitation > div > div.module__body > div > div.small-5.columns > div > div:nth-child(2) > lib-display-unit > span > span.wu-value.wu-value-to"
    # convert inch to mm
    value_template: '{{ (value | float * 25.4 ) | round(2) }}'
    scan_interval: 180
    unit_of_measurement: "mm/u"
    
  - platform: scrape
    resource: "https://www.wunderground.com/dashboard/pws/ILEUVE24"
#   resource: "https://www.wunderground.com/dashboard/pws/ILEUVE22"
    # hoeveelheid neerslag vandaag
    name: precip_total_leuven24_wunderground
#   select: "#main-page-content > div > div > div > div:nth-child(2) > div > lib-tile-current-conditions > div > div.module__body > div > div.weather__summary > div:nth-child(5) > div > div.weather__text > lib-display-unit > span > span.wu-value.wu-value-to"
    select: "#main-page-content > div > div > div > div:nth-child(8) > div > lib-tile-precipitation > div > div.module__body > div > div.small-5.columns > div > div:nth-child(4) > lib-display-unit > span > span.wu-value.wu-value-to"
    # convert inch to mm
    value_template: '{{ (value | float * 25.4 ) | round(2) }}'
    scan_interval: 600
    unit_of_measurement: "l/m²"
    
  - platform: scrape
    resource: "https://www.wunderground.com/dashboard/pws/ILEUVE24"
#   resource: "https://www.wunderground.com/dashboard/pws/ILEUVE22"
    # UV index
    name: uvindex_leuven24_wunderground
    select: "#main-page-content > div > div > div > div:nth-child(9) > div > lib-tile-uv > div > div.module__body > div > div.small-5.columns > div > div:nth-child(2) > lib-display-unit > span > span.wu-value.wu-value-to"
    scan_interval: 600
    unit_of_measurement: "index"

  - platform: scrape
    resource: "https://www.wunderground.com/precipitation/be/leuven/ILEUVE24?cm_ven=localwx_modprecip"
    name: precipitation_statement
    select: "#precip-graph > div > lib-precipitation-graph-alert > div > h2 > span"
    scan_interval: 1200

  - platform: template
    sensors:  
      living_tv_elec:
        unit_of_measurement: kWh
        friendly_name: "elektriciteitsverbruik TV living"
        value_template: "{{ states('sensor.tv_living_on_today') | float * 0.085 | round(3) }}"
   # TV consumes 82 W per hour + Google TV 3 W per hour
   
  - platform: template
    sensors:  
      master_bedroom_tv_elec:
        unit_of_measurement: kWh
        friendly_name: "elektriciteitsverbruik TV master bedroom"
        value_template: "{{ states('sensor.master_bedroom_TV_on_today') | float * 0.063 | round(3) }}"
   # TV + Google TV consumes 63 W per hour
   
#   Examples    
#   value_template: '{{ (value| float)}}'
#   value_template: '{{ (value.rstrip(" °C") | float) }}'
#   value_template: '{{ (value.rstrip(" %") | float) }}'

      tv_energy:
        friendly_name: "energieverbruik TV's"
        unit_of_measurement: kWh
        value_template: "{{ states('sensor.living_tv_elec') | float + states('sensor.master_bedroom_tv_elec') | float}}"
        attribute_templates:
          last_reset: "1970-01-01T00:00:00+00:00"
          state_class: measurement
          device_class: energy
          icon: mdi:counter

  - platform: systemmonitor
    resources:
    - type: processor_use
    - type: disk_use_percent
      arg: "/"
    - type: disk_free
      arg: "/"
    - type: memory_use_percent
    - type: network_in
      arg: eth0
    - type: throughput_network_in
      arg: eth0
    - type: network_out
      arg: eth0
    - type: throughput_network_out
      arg: eth0
    - type: processor_temperature
    - type: last_boot
# OPTIONAL CPU Raspberry Pi Temp
  - platform: command_line
    name: CPU Temp
    command: "cat /sys/class/thermal/thermal_zone0/temp"
    unit_of_measurement: "°C"
    value_template: '{{ value | multiply(0.001) | round(2)  }}'

  - platform: integration
    source: sensor.ty02820620a4cf12eb80b8_2
    name: droogkast_totaal_verbruik
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.living_tv_elec
    name: tv_living_totaal_verbruik
    unit_prefix: k
    round: 2

  - platform: filesize
    file_paths:
      - /config/home-assistant_v2.db

template:
  - sensor:
      - name: "badkamer raam"
        state: >
          {% if is_state('binary_sensor.badkamer_raam_wijd', 'on') %}
            wijd
          {% elif is_state('binary_sensor.badkamer_raam_kantel', 'on') %}
            gekanteld
          {% else %}
            Gesloten
          {% endif %}

      - name: "master bedroom raam"
        state: >
          {% if is_state('binary_sensor.master_bedroom_raam_wijd', 'on') %}
            wijd
          {% elif is_state('binary_sensor.master_bedroom_raam_kantel', 'on') %}
            gekanteld
          {% else %}
            Gesloten
          {% endif %}

adaptive_lighting:
- name: "living room bol adaptive lightning"
  lights: [light.living_bol]
  prefer_rgb_color: false
  transition: 45
  initial_transition: 1
  interval: 90
  min_brightness: 1
  max_brightness: 100
  min_color_temp: 2000
  max_color_temp: 5500
  sleep_brightness: 1
  sleep_color_temp: 1000
#  sunrise_time: '08:00:00'  # override the sunrise time
#  sunrise_offset:
#  sunset_time:
  sunset_offset: 1800  # in seconds or '00:15:00'
  take_over_control: true
  detect_non_ha_changes: false
  only_once: false

- name: "living room links adaptive lightning"
  lights: [light.living_links_4,light.living_links_5]
  prefer_rgb_color: false
  transition: 45
  initial_transition: 1
  interval: 90
  min_brightness: 1
  max_brightness: 100
  min_color_temp: 2000
  max_color_temp: 4000
  sleep_brightness: 1
  sleep_color_temp: 1000
#  sunrise_time: '08:00:00'  # override the sunrise time
#  sunrise_offset:
#  sunset_time:
  sunset_offset: 1800  # in seconds or '00:15:00'
  take_over_control: true
  detect_non_ha_changes: false
  only_once: true

- name: "master bedroom staande lamp adaptive lightning"
  lights: [light.staande_lamp]
  prefer_rgb_color: false
  transition: 45
  initial_transition: 1
  interval: 90
  min_brightness: 1
  max_brightness: 100
  min_color_temp: 2000
  max_color_temp: 5500
  sleep_brightness: 1
  sleep_color_temp: 1000
#  sunrise_time: '08:00:00'  # override the sunrise time
#  sunrise_offset:
#  sunset_time:
  sunset_offset: 1800  # in seconds or '00:15:00'
  take_over_control: true
  detect_non_ha_changes: false
  only_once: false

anniversaries:
  sensors:
  - name: huwelijk Madouce & Bart
    date: '2022-04-30'
  - name: verjaardag Alunya
    date: '10-10'
  - name: verjaardag Amilya
    date: '05-04'
  - name: verjaardag Madouce
    date: '02-06'
  - name: verjaardag Bart
    date: '05-03'

counter:
  toilet_counter:
    name: toilet bezoek
    initial: 0
    step: 1 
    
binary_sensor:
  - platform: ping
    name: google_server
    host: 8.8.8.8
    scan_interval: 5    # scan every 5 minutes

  - platform: template
    sensors:
      warm_outside_living:
        friendly_name: "buiten warmer dan in living"
        value_template: "{{ states('sensor.temp_leuven24_wunderground') > states('sensor.living_room_temperature') }}"
      warm_inside_living:
        friendly_name: "in living warmer dan buiten"
        value_template: "{{ states('sensor.living_room_temperature') > states('sensor.temp_leuven24_wunderground') }}"
      warm_outside_amilya:
        friendly_name: "buiten warmer dan in kamer Amilya"
        value_template: "{{ states('sensor.temp_leuven24_wunderground') > states('sensor.kamer_amilya_temperature') }}"
      warm_inside_amilya:
        friendly_name: "in kamer Amilya warmer dan buiten"
        value_template: "{{ states('sensor.kamer_amilya_temperature') > states('sensor.temp_leuven24_wunderground') }}"
      warm_outside_veranda:
        friendly_name: "buiten warmer dan in veranda"
        value_template: "{{ states('sensor.temp_leuven24_wunderground') > states('sensor.veranda_temperature') }}"
      warm_inside_veranda:
        friendly_name: "in veranda warmer dan buiten"
        value_template: "{{ states('sensor.veranda_temperature') > states('sensor.temp_leuven24_wunderground') }}"
      warm_outside_bedroom:
        friendly_name: "buiten warmer dan in master bedroom"
        value_template: "{{ states('sensor.temp_leuven24_wunderground') > states('sensor.master_bedroom_temperature') }}"
      warm_inside_bedroom:
        friendly_name: "in master bedroom warmer dan buiten"
        value_template: "{{ states('sensor.master_bedroom_temperature') > states('sensor.temp_leuven24_wunderground') }}"

  - platform: trend
    sensors:
    
      gram_water_outside_rising:
        entity_id: sensor.gram_water_outside
        sample_duration: 4800
        max_samples: 20
        # 1 sample every second. 1800 seconds = 30 minutes  3600 seconds = 1 hour
        min_gradient: 0.00011      # The gradient is measured in sensor units per second (independent from the duration ?)
        # If you want to know when the humidity is rising by 0.5 gram per hour, use a gradient of (0.5) / (60 x 60) = 0.000139
        
      gram_water_outside_falling:
        entity_id: sensor.gram_water_outside
        sample_duration: 4800
        max_samples: 20
        # 1 sample every second. 1800 seconds = 30 minutes
        min_gradient: -0.00011
        # The gradient is measured in sensor units per second
        # If you want to know when the humidity is rising by 0.5 gram per hour, use a gradient of (0.5) / (60 x 60) = 0.000139

      gram_water_master_bedroom_rising:
        entity_id: sensor.gram_water_master_bedroom
        sample_duration: 3600
        # 1 sample every second. 1800 seconds = 30 minutes
        min_gradient: 0.00011      # The gradient is measured in sensor units per second (independent from the duration ?)
        # If you want to know when the humidity is rising by 0.5 gram per hour, use a gradient of (0.8) / (60 x 60) = 0.000139
        max_samples: 10

      humidity_master_bedroom_rising:
        entity_id: sensor.master_bedroom_humidity
        sample_duration: 3600
        # 1 sample every second. 1800 seconds = 30 minutes
        min_gradient: 0.0004
        device_class: moisture
        # The gradient is measured in sensor units per second
        # If you want to know when the humidity is rising by 4 % per hour, use a gradient of (4) / (60 x 60) = 0.00111111111
        
      humidity_kamer_alunya_rising:
        entity_id: sensor.kamer_alunya_humidity
        sample_duration: 3600
        # 1 sample every second. 1800 seconds = 30 minutes
        min_gradient: 0.00027777777
        device_class: moisture

      humidity_badkamer_rising:
        entity_id: sensor.badkamer_humidity
        sample_duration: 3600
        # 1 sample every second. 1800 seconds = 30 minutes
        min_gradient: 0.00027777777
        device_class: moisture

      humidity_eikenbos_rising:
        entity_id: sensor.humidity_leuven24_wunderground
        sample_duration: 3600  # 1 hour
        min_gradient: 0.00027777777
# 4% increase per hour = 4/(60x60) = 0.00111111111
        device_class: moisture

      humidity_eikenbos_falling:
        entity_id: sensor.humidity_leuven24_wunderground
        sample_duration: 3600  # 1 hour
        min_gradient: -0.00027777777
# 4% increase per hour = 4/(60x60) = 0.00111111111
        device_class: moisture

# Enables a map showing the location of tracked devices
map:

# Mapping of the phone to a fixed name
# If you change smartphone, you can easily change the mapping and keep the fixed name in the automations.

notify:
  - name: bart_phone
    platform: group
    services:
      - service: mobile_app_bart_s10

  - name: madouce_phone
    platform: group
    services:
      - service: mobile_app_madouce_s20

  - name: alunya_phone
    platform: group
    services:
      - service: mobile_app_sm_a715f

timer:
  car_climatisation:
    icon: mdi:radiator      