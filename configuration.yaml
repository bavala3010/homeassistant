# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

# useful links
# https://www.uuidgenerator.net/
# https://emojidb.org/
# https://pictogrammers.github.io/@mdi/font/5.3.45/
# https://materialdesignicons.com/
# https://mdi.bessarabov.com/
# https://www.zapsplat.com/sound-effect-category/sirens-and-alarms/
# https://app.diagrams.net/
# https://demo.home-assistant.io/#/energy

# integration (Riemann sum integral) unit moet k, M, G of T zijn. (NIET kW of kWh) 

# An integration sensor isuseful in energy billing scenarios since energy is generally billed in kWh and many sensors provide power in W (Watts).
# If you have a sensor that provides you with power readings in Watts (uses W as unit_of_measurement), then you can use the integration sensor to track how much energy is being spent.

#   Examples
#   value_template: '{{ (value| float)}}'
#   value_template: '{{ (value.rstrip(" °C") | float) }}'
#   value_template: '{{ (value.rstrip(" %") | float) }}'



discovery:

# Text to speech
tts:
  - platform: google_translate
    cache: false
    cache_dir: /tmp/tts
    time_memory: 57600    #min 60 max 57600 (16 hours)
    base_url: http://192.168.86.101:8123
    service_name: google_say
    language: 'nl'
    
  - platform: google_cloud
    language: nl-BE
    gender: male

group: !include groups.yaml
automation: !include automations.yaml
# script: !include scripts.yaml
# include all scripts from the subfolder called "scripts"

script: !include_dir_merge_named scripts
scene: !include scenes.yaml
google_assistant: !include google_assistant_integration.yaml

frontend:
  themes: !include_dir_merge_named themes
  extra_module_url:
    - /hacsfiles/hass-hue-icons/hass-hue-icons.js

homeassistant:
  allowlist_external_dirs:
    - "/config"
### The following installs all package files, including lights, alarm, humidity etc.
  packages: !include_dir_named packages
  customize: !include customize.yaml
  
  external_url: http://bartland.duckdns.org
  time_zone: "Europe/Brussels"

# secrets should not be mentioned in this file; it is automatic !
# secrets: !include secrets.yaml

# manuele aanpassing van alle sensoren eindigend op "energieverbruik" om in het energy dashboard te krijgen
  customize_glob:
    sensor.*energieverbruik:
      unit_of_measurement: "kWh"     
      device_class: energy
      state_class: measurement
      last_reset: "1970-01-01T00:00:00+00:00"

# needed when using reverse proxy managers (eg. Nginx)
http:
  use_x_forwarded_for: true
  trusted_proxies:
    - 192.168.86.0/24 # the IP address of the proxy server
    - 172.20.0.0/24
    - 172.17.0.0/24
    - 172.0.0.0/24

#pi_hole:
#  host: 192.168.86.101:8081
#  name: pihole
#  api_key: !secret pihole_api_key
           
recorder:
  purge_keep_days: 7
  exclude:
    entities:
      - sensor.cpu
      - sensor.date
      - sensor.time
      - sensor.last_boot
      - sensor.low_battery
      - sun.sun
      - sensor.processor_use
      - sensor.disk_use_percent
      - binary_sensor.alunya_a71_apparaat_vergrendeld
      - binary_sensor.alunya_a71_applicatie_inactief
      - binary_sensor.alunya_a71_interactief
      - binary_sensor.sm_g975f_device_locked
      - binary_sensor.sm_g975f_interactive
      - sensor.sm_g975f_last_notification
      - sensor.sm_g975f_pressure_sensor
      - sensor.sm_g975f_app_memory
      - sensor.madouce_s20_druksensor
      - sensor.madouce_s20_aantal_actieve_meldingen
      - sensor.madouce_s20_app_geheugen
      - sensor.google_wifi_system_aaaaabzipgy_upload_traffic
      - sensor.google_wifi_system_aaaaabzipgy_download_traffic
      - sensor.network_in_eth0
    domains:
      - automation
      - camera
      - group
      - updater
      - persistent_notification
      - script
      - sun
      - weather
      - zone
      - zwave
      # do not exclude mediaplayer, otherwise the daily statistics will not work

###############################################################################
# Defines the Xiaomi devices (2 fans + 1 air purifier)
###############################################################################

#fan:
#  - platform: xiaomi_miio_fan
#    name: Xiaomi Smart Fan 3C
#    host: 192.168.86.29
#    token: !secret fan_3C_token
#    
#  - platform: xiaomi_miio_fan
#    name: Xiaomi Smart Fan 1C
#    host: 192.168.86.28
#    token: !secret fan_1C_token
#    
#  - platform: xiaomi_miio_airpurifier
#    name: Xiaomi Air Purifier 3H
#    host: 192.168.86.247
#    token: !secret purifier_3H_token
#    model: zhimi.airpurifier.mb3

netatmo:
# create client_id and client_secret at https://dev.netatmo.com/apps
# Waarschoot
#  client_id: 60d72f7458da3d00f57f4fd5 
#  client_secret: cEP5HXSCw74AEey7KkpEFIBwrzO

# Eikenbos
  client_id: 60e3e87226bd613977210595
  client_secret: t3OJP8WvSQR538Wb1WpAXqARxfzq

alarm_control_panel:
  - platform: manual
    name: home_alarm
    code: !secret alarm_code
    code_arm_required: false
    arming_time: 60
    delay_time: 5
    trigger_time: 4
    disarmed:
      trigger_time: 0
    armed_home:
      arming_time: 0
      delay_time: 0

#String om bij te houden welke sensor het alarm triggert
input_text:
  trigger_source:
    name: Trigger Source

utility_meter:
  daily_energy:
    source: sensor.ty02820620a4cf12eb80b8_2
    cycle: daily
  monthly_energy:
    source: sensor.ty02820620a4cf12eb80b8_2
    cycle: monthly

sensor:

  # sensors to check if there are updates in Ubuntu
  - platform: command_line
    name: System Updates
    scan_interval: 86400
    command: "cat /local/system_updates.out | cut -d ';' -f 1"
  - platform: command_line
    name: Security Updates
    scan_interval: 86400
    command: "cat /local/system_updates.out | cut -d ';' -f 2"

###############################################################################
# Calculate the absolute humidity (gram w/m³) in every room and outside  
###############################################################################
  
  - platform: thermal_comfort
    sensors:
      outside_thermal:
        friendly_name: outside
        temperature_sensor: sensor.temp_leuven24_wunderground
        humidity_sensor: sensor.humidity_leuven24_wunderground
      living_thermal:
        friendly_name: living
        temperature_sensor: sensor.living_temperature
        humidity_sensor: sensor.living_humidity
      kamer_amilya_thermal:
        friendly_name: kamer Amilya
        temperature_sensor: sensor.kamer_amilya_temperature
        humidity_sensor: sensor.kamer_amilya_humidity
      veranda_thermal:
        friendly_name: veranda
        temperature_sensor: sensor.veranda_temperature
        humidity_sensor: sensor.veranda_humidity
      berging_thermal:
        friendly_name: berging
        temperature_sensor: sensor.berging_temperature
        humidity_sensor: sensor.berging_humidity
      gang_thermal:
        friendly_name: gang
        temperature_sensor: sensor.gang_temperature
        humidity_sensor: sensor.gang_humidity
      badkamer_thermal:
        friendly_name: badkamer
        temperature_sensor: sensor.badkamer_temperature
        humidity_sensor: sensor.badkamer_humidity
      kamer_alunya_thermal:
        friendly_name: kamer Alunya
        temperature_sensor: sensor.kamer_alunya_temperature
        humidity_sensor: sensor.kamer_alunya_humidity
      master_bedroom_thermal:
        friendly_name: master bedroom
        temperature_sensor: sensor.master_bedroom_temperature
        humidity_sensor: sensor.master_bedroom_humidity

  - platform: template
    sensors:
      xiaomi_air_purifier_air_quality_pm25:
        friendly_name: "Air quality (AQI) PM2.5"
        value_template: "{{ state_attr('fan.xiaomi_air_purifier_3h', 'aqi') }}"
        unit_of_measurement: "μg/m³"
        icon_template: "mdi:weather-fog"


###############################################################################
#  Calc water /m³ in every room and outside
###############################################################################

  - platform: template
  # calculation of absolute humidity based on relative humidity and temperature
  # https://carnotcycle.wordpress.com/2012/08/04/how-to-convert-relative-humidity-to-absolute-humidity/
    sensors:
      gram_water_outside:
        friendly_name: 'gram vocht per m³ buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.temp_leuven24_wunderground')|float)) / (243.5 + (states('sensor.temp_leuven24_wunderground')|float)) ) * 6.112 * (states('sensor.humidity_leuven24_wunderground')|float) * 2.1674 ) / (273.15 + (states('sensor.temp_leuven24_wunderground')|float))) | round(1) }}

      gram_water_living:
        friendly_name: 'gram vocht per m³ in living'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.living_temperature')|float)) / (243.5 + (states('sensor.living_temperature')|float)) ) * 6.112 * (states('sensor.living_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.living_temperature')|float))) | round(1) }}

      gram_water_kamer_amilya:
        friendly_name: 'gram vocht per m³ in kamer Amilya'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.kamer_amilya_temperature')|float)) / (243.5 + (states('sensor.kamer_amilya_temperature')|float)) ) * 6.112 * (states('sensor.kamer_amilya_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.kamer_amilya_temperature')|float))) | round(1) }}

      gram_water_veranda:
        friendly_name: 'gram vocht per m³ in veranda'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.veranda_temperature')|float)) / (243.5 + (states('sensor.veranda_temperature')|float)) ) * 6.112 * (states('sensor.veranda_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.veranda_temperature')|float))) | round(1) }}

      gram_water_berging:
        friendly_name: 'gram vocht per m³ in berging'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.berging_temperature')|float)) / (243.5 + (states('sensor.berging_temperature')|float)) ) * 6.112 * (states('sensor.berging_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.kamer_amilya_temperature')|float))) | round(1) }}

      gram_water_badkamer:
        friendly_name: 'gram vocht per m³ in badkamer'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.badkamer_temperature')|float)) / (243.5 + (states('sensor.badkamer_temperature')|float)) ) * 6.112 * (states('sensor.badkamer_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.badkamer_temperature')|float))) | round(1) }}

      gram_water_gang:
        friendly_name: 'gram vocht per m³ in gang'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.gang_temperature')|float)) / (243.5 + (states('sensor.gang_temperature')|float)) ) * 6.112 * (states('sensor.gang_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.gang_temperature')|float))) | round(1) }}

      gram_water_kamer_alunya:
        friendly_name: 'gram vocht per m³ in kamer Alunya'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.kamer_alunya_temperature')|float)) / (243.5 + (states('sensor.kamer_alunya_temperature')|float)) ) * 6.112 * (states('sensor.kamer_alunya_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.kamer_alunya_temperature')|float))) | round(1) }}

      gram_water_master_bedroom:
        friendly_name: 'gram vocht per m³ in master bedroom'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: >-
          {{ ((e ** ((17.67 * (states('sensor.master_bedroom_temperature')|float)) / (243.5 + (states('sensor.master_bedroom_temperature')|float)) ) * 6.112 * (states('sensor.master_bedroom_humidity')|float) * 2.1674 ) / (273.15 + (states('sensor.master_bedroom_temperature')|float))) | round(1) }}

      gram_water_living_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in living en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_living') | float) - (states('sensor.gram_water_outside')|float)) | round(1) }}"

      gram_water_kamer_amilya_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in kamer Amilya en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_kamer_amilya') | float) - (states('sensor.gram_water_outside')|float)) | round(1) }}"

      gram_water_veranda_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in veranda en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_veranda') | float) - (states('sensor.gram_water_outside')|float)) | round(1) }}"

      gram_water_berging_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in berging en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_berging') | float) - (states('sensor.gram_water_outside')|float)) | round(1) }}"

      gram_water_badkamer_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in badkamer en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_badkamer') | float) - (states('sensor.gram_water_outside')|float)) | round(1) }}"

      gram_water_gang_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in gang en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_gang') | float) - (states('sensor.gram_water_outside') |float )) | round(1) }}"

      gram_water_kamer_alunya_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in kamer Alunya en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_kamer_alunya') | float) - (states('sensor.gram_water_outside') |float )) | round(1) }}"

      gram_water_master_bedroom_diff_outside:
        friendly_name: 'verschil gram vocht per m³ in master bedroom en buiten'
        device_class: humidity
        unit_of_measurement: 'g/m³'
        icon_template: mdi:water
        value_template: "{{ ((states('sensor.gram_water_master_bedroom') | float) - (states('sensor.gram_water_outside') |float )) | round(1) }}"

      outside_enthalpy:
        friendly_name: 'enthalpy buiten'
        unit_of_measurement: KJ/kg      
        value_template: "{{ (1.006 * (states('sensor.temp_leuven24_wunderground') | float )) + ( (states('sensor.outside_thermal_absolutehumidity') | float / 1000) * (2501 + 1.84 * (states('sensor.temp_leuven24_wunderground') | float(default=0) ))) | round (2) }}" 

      veranda_enthalpy:
        friendly_name: 'enthalpy veranda'
        unit_of_measurement: KJ/kg      
        value_template: "{{ (1.006 * (states('sensor.veranda_temperature') | float )) + ( (states('sensor.veranda_thermal_absolutehumidity') | float / 1000) * (2501 + 1.84 * (states('sensor.veranda_temperature') | float ))) | round (2) }}" 

      master_bedroom_enthalpy:
        friendly_name: 'enthalpy master bedroom'
        unit_of_measurement: KJ/kg      
        value_template: "{{ (1.006 * (states('sensor.master_bedroom_temperature') | float) ) + ( (states('sensor.master_bedroom_thermal_absolutehumidity') | float / 1000) * (2501 + 1.84 * (states('sensor.master_bedroom_temperature') | float ))) | round (2) }}" 

      car_range_per_10percent:
        friendly_name: 'range per 10%'
        unit_of_measurement: km
        value_template: "{{ (10 * states('sensor.audi_e_tron_sportback_55_primary_engine_range') | float(default=0) / states('sensor.audi_e_tron_sportback_55_state_of_charge') | float(default=0) ) | round (1) }}" 

###############################################################################
# Powercalc measures the power consumption of lights 
###############################################################################

  - platform: powercalc
    create_group: living alle lichten
    entities:
      -  entity_id: light.living_links_1
      -  entity_id: light.living_links_2
      -  entity_id: light.living_links_3
      -  entity_id: light.living_links_4
      -  entity_id: light.living_links_5
      -  entity_id: light.living_rechts_1  
      -  entity_id: light.living_rechts_2
      -  entity_id: light.living_rechts_3
      -  entity_id: light.living_rechts_4
      -  entity_id: light.living_rechts_5
    manufacturer: signify
    model: LCT003
    # creates 2 sensors called
    #   sensor.all_living_lights_power (in W)
    #   sensor.all_living_lights_energy (in kWh)

  - platform: powercalc
    entity_id: light.living_bol
    manufacturer: signify
    model: LCT015
    # creates a sensor called sensor.living_bol_power

  - platform: powercalc
    create_group: Amilya alle lichten
    entities:
      -  entity_id: light.amilya_badkamer
      -  entity_id: light.amilya_bol
      -  entity_id: light.amilya_strip
      -  entity_id: light.amilya_plafond
      -  entity_id: light.amilya_staande_lamp

  - platform: powercalc
    entity_id: light.veranda
    manufacturer: signify
    model: LCT015

  - platform: powercalc
    entity_id: light.gang
    manufacturer: signify
    model: LCT003
    multiply_factor: 3
    
  - platform: powercalc
    entity_id: light.wasbak_rechts
    manufacturer: signify
    model: LCT003
    
  - platform: powercalc
    entity_id: light.douche
    manufacturer: signify
    model: LCT003
    
  - platform: powercalc
    entity_id: light.bad
    manufacturer: signify
    model: LCT003

  - platform: powercalc
    create_group: Alunya alle lichten
    entities:
      -  entity_id: light.alunya_bol
      -  entity_id: light.alunya_staande_lamp
      -  entity_id: light.alunya_wasbak

  - platform: powercalc
    create_group: master bedroom alle lichten
    entities:
      -  entity_id: light.master_bedroom_play_bart
      -  entity_id: light.master_bedroom_play_madouce
      -  entity_id: light.master_bedroom_staande_lamp

  - platform: powercalc
    create_group: master bedroom play bar lights 
    entities:
      -  entity_id: light.master_bedroom_play_bart
      -  entity_id: light.master_bedroom_play_madouce
    multiply_factor: 2
    manufacturer: signify
    model: LCT024
    
  - platform: powercalc
    entity_id: light.buiten
    manufacturer: signify
    model: LCT015     # model 1744630P7 not found
    multiply_factor: 2

###############################################################################
# historiek TV
###############################################################################

  - platform: history_stats
    name: "Living TV aan vandaag"
    entity_id: media_player.ue55ju7000
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "Amilya TV aan vandaag"
    entity_id: media_player.amilya_tv
    state: "playing"
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "Alunya TV aan vandaag"
    entity_id: media_player.alunya_tv
    state: "playing"
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'
 
  - platform: history_stats
    name: "master bedroom TV aan vandaag"
    entity_id: binary_sensor.master_bedroom_tv_on
    state: "on"
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "veranda speaker aan vandaag"
    entity_id: media_player.veranda_speaker
    state: "playing"
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

#####################################################################
# historiek laptops
#####################################################################
  - platform: history_stats
    name: "Chromebook Bart/Madouce aan vandaag"
    entity_id: switch.bart_chromebook_chromeos_device
    state: "on"
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'
    
  - platform: history_stats
    name: "Laptop Bart Fortis aan vandaag"
    entity_id: switch.bart_laptop_fortis_brum05007458
    state: "on"
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'
    
  - platform: history_stats
    name: "Windows laptop aan vandaag"
    entity_id: switch.bart_utraland_notebook_wifi_windows_device
    state: "on"
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'
    
#####################################################################
# historiek lichten
#####################################################################
    
  - platform: history_stats
    name: "living lichten links aan vandaag"
    entity_id: light.living_links 
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "living lichten rechts aan vandaag"
    entity_id: light.living_rechts 
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "gang lichten aan vandaag"
    entity_id: light.gang
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "veranda licht aan vandaag"
    entity_id: light.veranda 
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "Alunya licht bol aan vandaag"
    entity_id: light.alunya_bol 
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "Alunya licht staande lamp aan vandaag"
    entity_id: light.alunya_staande_lamp
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "Alunya licht wasbak aan vandaag"
    entity_id: light.alunya_wasbak
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

#####################################################################
# historiek ramen
#####################################################################

  - platform: history_stats
    name: "keuken raam open vandaag"
    entity_id: binary_sensor.keuken_raam 
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "Amilya raam open vandaag"
    entity_id: binary_sensor.kamer_amilya_raam 
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "badkamer raam gekanteld vandaag"
    entity_id: binary_sensor.badkamer_raam_kantel 
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "badkamer raam wijd open vandaag"
    entity_id: binary_sensor.badkamer_raam_wijd
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "Alunya raam open vandaag"
    entity_id: binary_sensor.kamer_alunya_raam 
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "Alunya schuifraam open vandaag"
    entity_id: binary_sensor.kamer_alunya_schuifraam 
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "master bedroom raam gekanteld vandaag"
    entity_id: binary_sensor.master_bedroom_raam_kantel 
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

  - platform: history_stats
    name: "master bedroom raam wijd open vandaag"
    entity_id: binary_sensor.master_bedroom_raam_wijd 
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

###############################################################################
# 
###############################################################################

  - platform: afvalbeheer
    wastecollector: RecycleApp
    resources:
      - restafval
      - gft
      - papier
      - pmd
    postcode: 3010
    streetname: !secret streetname
    streetnumber: 25
    upcomingsensor: 1
    dateformat: '%d-%m-%Y'
    dateonly: 0
    name: ""
    nameprefix: 1
    builtinicons: 1
    dutch: 1

  - platform: buienalarm
    timeframe: 15
    name: buienalarm
    monitored_conditions:
      - temperature
      - precipitation
      - precipitation_forecast_average
      - precipitation_forecast_total
      - next_rain_forecast

  - platform: time_date
    display_options:
      - 'time'
      - 'date'
      - "date_time"

  - platform: min_max
    type: mean
    name: avg_outside_temp
    entity_ids:
      - sensor.buitensensor_vooraan_temperature
      - sensor.buitensensor_deur_temperature
      - sensor.temp_leuven24_wunderground
      - sensor.temp_leuven24_wunderground
      - sensor.temp_leuven24_wunderground
    round_digits: 2
    
  - platform: min_max
    type: mean
    name: avg_inside_humidity
    entity_ids:
      - sensor.living_humidity
      - sensor.kamer_amilya_humidity
      - sensor.veranda_humidity
      - sensor.gang_humidity
      - sensor.badkamer_humidity
      - sensor.kamer_alunya_humidity
      - sensor.master_bedroom_humidity
    round_digits: 0
    
  - platform: min_max
    type: mean
    name: avg_inside_temperature
    entity_ids:
      - sensor.living_temperature
      - sensor.kamer_amilya_temperature
      - sensor.veranda_temperature
      - sensor.gang_temperature
      - sensor.badkamer_temperature
      - sensor.kamer_alunya_temperature
      - sensor.master_bedroom_temperature
    round_digits: 1
    
###############################################################################
# Scrape weather info from the local weather station
###############################################################################
    
  - platform: scrape
    resource: "https://www.wunderground.com/dashboard/pws/ILEUVE24"
#   resource: "https://www.wunderground.com/dashboard/pws/ILEUVE22"
    select: "#main-page-content > div > div > div > div:nth-child(2) > div > lib-tile-current-conditions > div > div.module__body > div > div.small-4.columns.text-left.conditions-temp > div.main-temp > lib-display-unit > span > span.wu-value.wu-value-to"
    name: temp_leuven24_wunderground
#   convert Farenheit to Celcius
    value_template: '{{ ((value | float -32) * (5/9)) |round(1) }}'
    scan_interval: 240
    unit_of_measurement: "°C"
    
  - platform: scrape
    resource: "https://www.wunderground.com/dashboard/pws/ILEUVE24"
#   resource: "https://www.wunderground.com/dashboard/pws/ILEUVE22"
    select: '<span _ngcontent-app-root-c173="">Offline</span>'
    name: online_status_leuven24_wunderground
    scan_interval: 600
    
  - platform: scrape
    resource: "https://www.wunderground.com/dashboard/pws/ILEUVE24"
#   resource: "https://www.wunderground.com/dashboard/pws/ILEUVE22"
    name: humidity_leuven24_wunderground
    select: "#main-page-content > div > div > div > div:nth-child(2) > div > lib-tile-current-conditions > div > div.module__body > div > div.weather__summary > div:nth-child(4) > div > div.weather__text > lib-display-unit > span > span.wu-value.wu-value-to"
    scan_interval: 240
    unit_of_measurement: "%"

  - platform: scrape  
    resource: "https://www.wunderground.com/dashboard/pws/ILEUVE24"
#   resource: "https://www.wunderground.com/dashboard/pws/ILEUVE22"
    # hoeveelheid huidige neerslag
    name: precip_rate_leuven24_wunderground
    select: "#main-page-content > div > div > div > div:nth-child(8) > div > lib-tile-precipitation > div > div.module__body > div > div.small-5.columns > div > div:nth-child(2) > lib-display-unit > span > span.wu-value.wu-value-to"
    # convert inch to mm
    value_template: '{{ (value | float * 25.4 ) | round(2) }}'
    scan_interval: 180
    unit_of_measurement: "mm/u"
    
  - platform: scrape
    resource: "https://www.wunderground.com/dashboard/pws/ILEUVE24"
#   resource: "https://www.wunderground.com/dashboard/pws/ILEUVE22"
    # hoeveelheid neerslag vandaag
    name: precip_total_leuven24_wunderground
#   select: "#main-page-content > div > div > div > div:nth-child(2) > div > lib-tile-current-conditions > div > div.module__body > div > div.weather__summary > div:nth-child(5) > div > div.weather__text > lib-display-unit > span > span.wu-value.wu-value-to"
    select: "#main-page-content > div > div > div > div:nth-child(8) > div > lib-tile-precipitation > div > div.module__body > div > div.small-5.columns > div > div:nth-child(4) > lib-display-unit > span > span.wu-value.wu-value-to"
    # convert inch to mm
    value_template: '{{ (value | float * 25.4 ) | round(2) }}'
    scan_interval: 600
    unit_of_measurement: "l/m²"
    
  - platform: scrape
    resource: "https://www.wunderground.com/dashboard/pws/ILEUVE24"
#   resource: "https://www.wunderground.com/dashboard/pws/ILEUVE22"
    # UV index
    name: uvindex_leuven24_wunderground
    select: "#main-page-content > div > div > div > div:nth-child(9) > div > lib-tile-uv > div > div.module__body > div > div.small-5.columns > div > div:nth-child(2) > lib-display-unit > span > span.wu-value.wu-value-to"
    scan_interval: 600
    unit_of_measurement: "index"

  - platform: scrape
    resource: "https://www.wunderground.com/precipitation/be/leuven/ILEUVE24?cm_ven=localwx_modprecip"
    name: precipitation_statement
    select: "#precip-graph > div > lib-precipitation-graph-alert > div > h2 > span"
    scan_interval: 1200

###############################################################################
# Sensor to calculate the consumption of lights
###############################################################################

  - platform: template
    sensors:
      all_lights_power:
        friendly_name: Alle lichten power
        unit_of_measurement: W
        icon_template: mdi:transmission-tower
        device_class: power
        value_template: >
          {{ expand('group.all_lights_power') 
          | rejectattr('state', 'in', ['unavailable', 'unknown'])
          | map(attribute='state') | map('float') | sum | round(2) }}


###############################################################################
# Sensor to calculate the energie consumption tv 
###############################################################################

  - platform: template
    sensors:  
      living_tv_powerconsumption:
        value_template: >
          {% if is_state('media_player.ue55ju7000', 'on') %}
            85
          {% else %}
            0
          {% endif %}
        device_class: 'power'
        unit_of_measurement: 'W'
   # creates a sensor called sensor.living_tv_powerconsumption
   # TV consumes 82 W + Google TV 3 W

  - platform: template
    sensors:  
      master_bedroom_tv_powerconsumption:
        value_template: >
          {% if is_state('media_player.master_bedroom_tv', 'on') %}
            63
          {% else %}
            0
          {% endif %}
        device_class: 'power'
        unit_of_measurement: 'W'
   # creates a sensor called sensor.master_bedroom_tv_powerconsumption
   # TV + Google TV consumes 63 W

  - platform: template
    sensors:  
      amilya_tv_powerconsumption:
        value_template: >
          {% if is_state('binary_sensor.amilya_tv_on', 'on') %}
            82
          {% else %}
            0
          {% endif %}
        device_class: 'power'
        unit_of_measurement: 'W'
   # creates a sensor called sensor.amilya_tv_powerconsumption
   # TV consumes 82 W + Google Chromecast 3 W

  - platform: template
    sensors:  
      alunya_tv_powerconsumption:
        value_template: >
          {% if is_state('binary_sensor.alunya_tv_on', 'on') %}
            82
          {% else %}
            0
          {% endif %}
        device_class: 'power'
        unit_of_measurement: 'W'
   # creates a sensor called sensor.alunya_tv_powerconsumption
   # TV consumes 82 W + Google Chromecast 3 W

  - platform: template
    sensors:
      day_max_temp_datetime:
        friendly_name: "max dagtemperatuur uur"
        unit_of_measurement: "h"
        # entity_id: weather.openweathermap
        value_template: >
          {% set start = now().replace(hour=0,minute=0,second=0, microsecond=0) %}
          {% set end = (start + timedelta(days=1)) %}
          {% set start = start.strftime("%Y-%m-%dT%H:%M:%S+00:00") %}
          {% set end = end.strftime("%Y-%m-%dT%H:%M:%S+00:00") %}
          {% set ns = namespace(min_temp=100, max_temp=-100) %}
          {% for i in state_attr('weather.openweathermap', 'forecast') -%}
            {% if start <= i.datetime < end %}
              {% if i.temperature < ns.min_temp %}
                {% set ns.min_temp = i.temperature %}
                {% set ns.min_temp_datetime = i.datetime %}
              {% endif %}
              {% if i.temperature > ns.max_temp %}
                {% set ns.max_temp = i.temperature %}
                {% set ns.max_temp_datetime = i.datetime %}
              {% endif %}
            {% endif %}
          {% endfor %}
          {{ as_timestamp(ns.max_temp_datetime)|timestamp_custom('%H:%M') }}

###############################################################################
# Sensors to measure Raspberry Pi components 
###############################################################################
  - platform: systemmonitor
    resources:
    - type: processor_use
    - type: disk_use_percent
#      arg: /
    - type: disk_free
#      arg: /
    - type: memory_use_percent
    - type: network_in
      arg: eth0
    - type: throughput_network_in
      arg: eth0
    - type: network_out
      arg: eth0
    - type: throughput_network_out
      arg: eth0
    - type: processor_temperature
    - type: last_boot
    
  # OPTIONAL CPU Raspberry Pi Temp
  - platform: command_line
    name: CPU Temp
    command: "cat /sys/class/thermal/thermal_zone0/temp"
    unit_of_measurement: "°C"
    value_template: '{{ value | multiply(0.001) | round(2)  }}'

###################################################################################
# Integration
# The Riemann sum integration calculates energy (in kWh) from a power sensor (in W)
# integration (Riemann sum integral) unit moet k, M, G of T zijn. (NIET kW of kWh) 
###################################################################################

#  - platform: integration
#    source: sensor.all_lights_power
#    name: Totaal energieverbruik lichten
#    unit_prefix: k
#    unit: kWh
#    round: 2
  
  - platform: integration
    source: sensor.ontvochtiger_power
    name: ontvochtiger energieverbruik
    unit_prefix: k
    # apparaten die bij het starten pieken veroorzaken, moeten de left methode gebruiken
    method: left
    round: 2
    # creates a sensor called sensor.ontvochtiger_energieverbruik

  - platform: integration
    source: sensor.living_tv_powerconsumption
    name: living tv energieverbruik
    unit_prefix: k
    method: left
    round: 2
    # creates sensor called sensor.living_tv_energieverbruik

  - platform: integration
    source: sensor.master_bedroom_tv_powerconsumption
    name: master bedroom tv energieverbruik
    method: left
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.amilya_tv_powerconsumption
    name: Amilya tv energieverbruik
    method: left
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.alunya_tv_powerconsumption
    name: Alunya tv energieverbruik
    method: left
    unit_prefix: k
    round: 2

###############################################################################
# Sensor to measure size of the Home Asisstant database 
###############################################################################
  - platform: filesize
    file_paths:
      - /config/home-assistant_v2.db

template:
  - sensor:
      - name: "badkamer raam"
        state: >
          {% if is_state('binary_sensor.badkamer_raam_wijd', 'on') %}
            wijd open
          {% elif is_state('binary_sensor.badkamer_raam_kantel', 'on') %}
            gekanteld
          {% else %}
            gesloten
          {% endif %}

      - name: "master bedroom raam"
        state: >
          {% if is_state('binary_sensor.master_bedroom_raam_wijd', 'on') %}
            wijd open
          {% elif is_state('binary_sensor.master_bedroom_raam_kantel', 'on') %}
            gekanteld
          {% else %}
            gesloten
          {% endif %}

      - name: "car smart charging start time"
        state: >
          {% set target = states('input_number.car_smart_charging_target_percentage') | float(default=0) %}
          {% set soc = states('sensor.audi_e_tron_sportback_55_state_of_charge') | float(default=0) %}
          {% set nog_te_laden_procent = [target - soc, 0] | max %}
          {% set nog_te_laden_minuten = nog_te_laden_procent * 8.5 | round(2) %}
          {{ strptime((as_timestamp(states('input_datetime.car_smart_charging_target_time')) - (nog_te_laden_minuten | float(default=0) * 60) )| timestamp_custom('%Y-%m-%d %H:%M',false), '%Y-%m-%d %H:%M') }}

###############################################################################
#
# adaptive lightning
# This changes the brightness of the lights according to the time of day
###############################################################################

adaptive_lighting:
- name: "living bol adaptive lightning"
  lights: [light.living_bol]
  prefer_rgb_color: false
  transition: 45
  initial_transition: 1
  interval: 90
  min_brightness: 1
  max_brightness: 100
  min_color_temp: 2000
  max_color_temp: 5500
  sleep_brightness: 1
  sleep_color_temp: 1000
#  sunrise_time: '08:00:00'  # override the sunrise time
#  sunrise_offset:
#  sunset_time:
  sunset_offset: 1800  # in seconds or '00:15:00'
  take_over_control: true
  detect_non_ha_changes: false
  only_once: false

- name: "living links adaptive lightning"
  lights: [light.living_links_4,light.living_links_5]
  prefer_rgb_color: false
  transition: 45
  initial_transition: 1
  interval: 90
  min_brightness: 1
  max_brightness: 100
  min_color_temp: 2000
  max_color_temp: 4000
  sleep_brightness: 1
  sleep_color_temp: 1000
#  sunrise_time: '08:00:00'  # override the sunrise time
#  sunrise_offset:
#  sunset_time:
  sunset_offset: 1800  # in seconds or '00:15:00'
  take_over_control: true
  detect_non_ha_changes: false
  only_once: true

- name: "master bedroom staande lamp adaptive lightning"
  lights: [light.master_bedroom_staande_lamp]
  prefer_rgb_color: false
  transition: 45
  initial_transition: 1
  interval: 90
  min_brightness: 1
  max_brightness: 100
  min_color_temp: 2000
  max_color_temp: 5500
  sleep_brightness: 1
  sleep_color_temp: 1000
#  sunrise_time: '08:00:00'  # override the sunrise time
#  sunrise_offset:
#  sunset_time:
  sunset_offset: 1800  # in seconds or '00:15:00'
  take_over_control: true
  detect_non_ha_changes: false
  only_once: false

###############################################################################
#
# anniversaries
# 
###############################################################################

anniversaries:
  sensors:
  - name: huwelijk Madouce & Bart
    date: '2022-04-30'
  - name: verjaardag Alunya
    date: '10-10'
  - name: verjaardag Amilya
    date: '05-04'
  - name: verjaardag Madouce
    date: '02-06'
  - name: verjaardag Bart
    date: '05-03'

counter:
  toilet_counter:
    name: toilet bezoek
    initial: 0
    step: 1 
    
binary_sensor:
  - platform: ping
    name: google_server
    host: 8.8.8.8
    scan_interval: 5    # scan every 5 minutes

  - platform: template
    sensors:
      master_bedroom_tv_on:
        friendly_name: "master bedroom tv aan"
        value_template: >-
          {{ states('media_player.master_bedroom_tv') in ['unknown', 'playing'] }}
    # als netflix speelt is de status "unknown"
    
  - platform: template
    sensors:
      alunya_tv_on:
        friendly_name: "Alunya tv aan"
        value_template: >-
          {{ states('media_player.alunya_tv') in ['unknown', 'playing'] }}
    # als netflix speelt is de status "unknown"

  - platform: template
    sensors:
      amilya_tv_on:
        friendly_name: "Amilya tv aan"
        value_template: >-
          {{ states('media_player.amilya_tv') in ['unknown', 'playing'] }}
    # als netflix speelt is de status "unknown"


###############################################################################
#
# binary sensors: warmer/kouder dan binnen/buiten
# 
###############################################################################

  - platform: template
    sensors:
      warm_outside_living:
        friendly_name: "buiten warmer dan in living"
        value_template: "{{ states('sensor.temp_leuven24_wunderground') > states('sensor.living_temperature') }}"
      warm_inside_living:
        friendly_name: "in living warmer dan buiten"
        value_template: "{{ states('sensor.living_temperature') > states('sensor.temp_leuven24_wunderground') }}"
      warm_outside_amilya:
        friendly_name: "buiten warmer dan in kamer Amilya"
        value_template: "{{ states('sensor.temp_leuven24_wunderground') > states('sensor.kamer_amilya_temperature') }}"
      warm_inside_amilya:
        friendly_name: "in kamer Amilya warmer dan buiten"
        value_template: "{{ states('sensor.kamer_amilya_temperature') > states('sensor.temp_leuven24_wunderground') }}"
      warm_outside_veranda:
        friendly_name: "buiten warmer dan in veranda"
        value_template: "{{ states('sensor.temp_leuven24_wunderground') > states('sensor.veranda_temperature') }}"
      warm_inside_veranda:
        friendly_name: "in veranda warmer dan buiten"
        value_template: "{{ states('sensor.veranda_temperature') > states('sensor.temp_leuven24_wunderground') }}"
      warm_outside_bedroom:
        friendly_name: "buiten warmer dan in master bedroom"
        value_template: "{{ states('sensor.temp_leuven24_wunderground') > states('sensor.master_bedroom_temperature') }}"
      warm_inside_bedroom:
        friendly_name: "in master bedroom warmer dan buiten"
        value_template: "{{ states('sensor.master_bedroom_temperature') > states('sensor.temp_leuven24_wunderground') }}"

      bart_phone_connected_to_car:
        friendly_name: 'Telefoon Bart verbonden met auto'
        device_class: connectivity
        icon_template: >-
          {% if is_state('binary_sensor.bart_phone_connected_to_car', 'on') %}
            mdi:car-connected
          {% else %}
            mdi:car
          {% endif %}
        value_template: "{{ '98:49:14:C1:37:0B' in state_attr('sensor.sm_g975f_bluetooth_connection', 'connected_paired_devices') }}"    
        # do not forget to activate the bluetooth sensor in the Home Assistant companion app on smartphone

      madouce_phone_connected_to_car:
        friendly_name: 'Telefoon Mardouce verbonden met auto'
        device_class: connectivity
        icon_template: >-
          {% if is_state('binary_sensor.madouce_phone_connected_to_car', 'on') %}
            mdi:car-connected
          {% else %}
            mdi:car
          {% endif %}
        value_template: "{{ '98:49:14:C1:37:0B' in state_attr('sensor.sm_g986b_bluetooth_connection', 'connected_paired_devices') }}"    
        # do not forget to activate the bluetooth sensor in the Home Assistant companion app on smartphone


  - platform: trend
    sensors:

###############################################################################
#
# Sensors to detect rising/falling humidity outside and in every room 
# Used to calculate when to open/close the windows
#
###############################################################################

      gram_water_outside_rising:
        entity_id: sensor.gram_water_outside
        sample_duration: 4800
        max_samples: 20
        # 1 sample every second. 1800 seconds = 30 minutes  3600 seconds = 1 hour
        min_gradient: 0.00011      # The gradient is measured in sensor units per second (independent from the duration ?)
        # If you want to know when the humidity is rising by 0.5 gram per hour, use a gradient of (0.5) / (60 x 60) = 0.000139
        
      gram_water_outside_falling:
        entity_id: sensor.gram_water_outside
        sample_duration: 4800
        max_samples: 20
        # 1 sample every second. 1800 seconds = 30 minutes
        min_gradient: -0.00011
        # The gradient is measured in sensor units per second
        # If you want to know when the humidity is rising by 0.5 gram per hour, use a gradient of (0.5) / (60 x 60) = 0.000139

      gram_water_master_bedroom_rising:
        entity_id: sensor.gram_water_master_bedroom
        sample_duration: 3600
        # 1 sample every second. 1800 seconds = 30 minutes
        min_gradient: 0.00011      # The gradient is measured in sensor units per second (independent from the duration ?)
        # If you want to know when the humidity is rising by 0.5 gram per hour, use a gradient of (0.8) / (60 x 60) = 0.000139
        max_samples: 10

      humidity_master_bedroom_rising:
        entity_id: sensor.master_bedroom_humidity
        sample_duration: 3600
        # 1 sample every second. 1800 seconds = 30 minutes
        min_gradient: 0.0004
        device_class: moisture
        # The gradient is measured in sensor units per second
        # If you want to know when the humidity is rising by 4 % per hour, use a gradient of (4) / (60 x 60) = 0.00111111111
        
      humidity_kamer_alunya_rising:
        entity_id: sensor.kamer_alunya_humidity
        sample_duration: 3600
        # 1 sample every second. 1800 seconds = 30 minutes
        min_gradient: 0.00027777777
        device_class: moisture

      humidity_badkamer_rising:
        entity_id: sensor.badkamer_humidity
        sample_duration: 3600
        # 1 sample every second. 1800 seconds = 30 minutes
        min_gradient: 0.0004
        device_class: moisture

      humidity_eikenbos_rising:
        entity_id: sensor.humidity_leuven24_wunderground
        sample_duration: 3600  # 1 hour
        min_gradient: 0.00027777777
        # 4% increase per hour = 4/(60x60) = 0.00111111111
        device_class: moisture

      humidity_eikenbos_falling:
        entity_id: sensor.humidity_leuven24_wunderground
        sample_duration: 3600  # 1 hour
        min_gradient: -0.00027777777
        # 4% increase per hour = 4/(60x60) = 0.00111111111
        device_class: moisture


# Enables a map showing the location of tracked devices
map:

###############################################################################
#
# Mapping of the phone to a fixed name
# If you change smartphone, you can easily change the mapping and keep the fixed name in the automations.
#
###############################################################################

notify:
  - name: bart_phone
    platform: group
    services:
      - service: mobile_app_sm_g975f

  - name: madouce_phone
    platform: group
    services:
      - service: mobile_app_sm_g986b

  - name: alunya_phone
    platform: group
    services:
      - service: mobile_app_sm_a715f

timer:
  car_climatisation:
    icon: mdi:radiator

rest_command:
# webhook om meterstanden op de site energieid te posten
  energie_id_set_electricity_usage:
    url: !secret energie_id_usage_webhook
    method: 'post'
    content_type: 'application/json'
    payload: '{"remoteId": "ha-webhook-electricity", "remoteName": "Elektriciteit (Home Assistant)", "metric": "electricityImport", "unit": "kWh", "readingType": "counter", "data": [["{{ now().isoformat() }}", {{ usage }}]]}'
 
# Deze code hieronder in automatisaties gebruiken    
# service: rest_command.energie_id_set_electricity_usage
#  data:
#    usage: "{{ states('input_number.electricity_usage') | int }}"  

proximity:
  bart_home:
    devices:
      - device_tracker.bart_s10
    tolerance: 50
    unit_of_measurement: km
    
  madouce_home:
    devices:
      - device_tracker.madouce_s20
    tolerance: 50
    unit_of_measurement: km
    

        