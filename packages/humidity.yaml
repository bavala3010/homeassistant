############################ Table of Contents ############################ 
# 
#   Automations
#     Vocht in master bedroom - open raam (Bart)
#     Vocht in master bedroom - open raam (Madouce)
#     Vocht in master bedroom - sluit raam (Bart)
#     Vocht in master bedroom - sluit raam (Madouce)
#     Vocht in kamer Alunya (Bart)
#     Vocht in kamer Alunya (Madouce)
#     Vocht in veranda - open raam (Bart)
#     Vocht buiten >80% = melding ramen dicht (Bart)
#     Vocht buiten >80% = melding ramen dicht (Madouce)
#     Vocht in huis >75%
#     Vocht master bedroom -> machine aan
#     Master bedroom raam werd geopend (Bart)
#     Veranda schuifraam werd geopend (Madouce)
############################ Automations ################################## 

automation:
- id: 'Vocht in master bedroom - open raam (Bart)'
  alias: ðŸ’§ Vocht in master bedroom - open raam (Bart)
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /15
  condition:
  - condition: state
    entity_id: binary_sensor.master_bedroom_raam_sensor
    state: 'off'
  - condition: state
    entity_id: input_boolean.master_bedroom_humidity_pause2h
    state: 'off'
  - condition: template
    value_template: "{{ states('sensor.master_bedroom_humidity') | float > 60 }}"
  - condition: template
    value_template: "{{ states('sensor.humidity_leuven24_wunderground') | float < 80 }}"
  - condition: state
    entity_id: binary_sensor.humidity_eikenbos_falling
    state: 'on'
  - condition: zone
    entity_id: person.bart
    zone: zone.home
  - condition: time
    after: '7:0:0'
    before: '23:00:00'
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.master_bedroom_raam_moet_open  
  - service: notify.mobile_app_bart_s10
    data:
      message: "Vocht in master bedroom: {{states('sensor.master_bedroom_humidity')}}%. Buiten {{states('sensor.humidity_leuven24_wunderground')}}%."
      title: Open het raam van de master bedroom!
      data:
        color: blue
        channel: Vocht
        timeout: 3600
        tag: vocht_master_bedroom
        actions:
        - action: master_bedroom_humidity_pause2h
          title: stel meldingen 2 uren uit
        - action: URI
          title: meer info
          uri: /lovelace/humidity
  mode: single
- id: 'Vocht in master bedroom - open raam (Madouce)'
  alias: ðŸ’§ Vocht in master bedroom - open raam (Madouce)
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /15
  condition:
  - condition: state
    entity_id: binary_sensor.master_bedroom_raam_sensor
    state: 'off'
  - condition: state
    entity_id: input_boolean.master_bedroom_humidity_pause2h
    state: 'off'
  - condition: template
    value_template: "{{ states('sensor.master_bedroom_humidity') | float > 60 }}"
  - condition: template
    value_template: "{{ states('sensor.humidity_leuven24_wunderground') | float < 80 }}"
  - condition: state
    entity_id: binary_sensor.humidity_eikenbos_falling
    state: 'on'
  - condition: zone
    entity_id: person.madouce
    zone: zone.home
  - condition: time
    after: '7:0:0'
    before: '23:00:00'
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.master_bedroom_raam_moet_open  
  - service: notify.mobile_app_madouce_s20
    data:
      message: "Vocht in master bedroom: {{states('sensor.master_bedroom_humidity')}}%. Buiten {{states('sensor.humidity_leuven24_wunderground')}}%."
      title: Open het raam van de master bedroom!
      data:
        color: blue
        channel: Vocht
        timeout: 3600
        tag: vocht_master_bedroom
        actions:
        - action: master_bedroom_humidity_pause2h
          title: stel meldingen 2 uren uit
        - action: URI
          title: meer info
          uri: /lovelace/humidity
  mode: single
- id: 'Vocht in master bedroom - sluit raam (Bart)'
  alias: ðŸ’§ Vocht in master bedroom - sluit raam (Bart)
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /15
  condition:
  - condition: state
    entity_id: binary_sensor.master_bedroom_raam_sensor
    state: 'on' # on = open / off = closed
  - condition: state
    entity_id: binary_sensor.humidity_master_bedroom_rising
    state: 'on'
  - condition: template
    value_template: "{{ states('sensor.humidity_leuven24_wunderground') | float > 80 }}"
  - condition: state
    entity_id: binary_sensor.humidity_eikenbos_rising
    state: 'on'
  - condition: zone
    entity_id: person.bart
    zone: zone.home
  - condition: time
    after: '7:0:0'
    before: '23:00:00'
  action:
  - service: notify.mobile_app_bart_s10
    data:
      message: "Vocht in master bedroom: {{states('sensor.master_bedroom_humidity')}}%. Buiten {{states('sensor.humidity_leuven24_wunderground')}}%."
      title: Sluit het raam van de master bedroom!
      data:
        color: blue
        channel: Vocht
        timeout: 3600
        tag: vocht_master_bedroom
        actions:
        - action: URI
          title: Meer info
          uri: /lovelace/humidity
  mode: single
- id: 'Vocht in master bedroom - sluit raam (Madouce)'
  alias: ðŸ’§ Vocht in master bedroom - sluit raam (Madouce)
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /15
  condition:
  - condition: state
    entity_id: binary_sensor.master_bedroom_raam_sensor
    state: 'on' # on = open / off = closed
  - condition: state
    entity_id: binary_sensor.humidity_master_bedroom_rising
    state: 'on'
  - condition: template
    value_template: "{{ states('sensor.humidity_leuven24_wunderground') | float > 80 }}"
  - condition: state
    entity_id: binary_sensor.humidity_eikenbos_rising
    state: 'on'
  - condition: zone
    entity_id: person.madouce
    zone: zone.home
  - condition: time
    after: '7:0:0'
    before: '23:00:00'
  action:
  - service: notify.mobile_app_madouce_s20
    data:
      message: "Vocht in master bedroom: ({{states('sensor.master_bedroom_humidity')}}%). Buiten ({{states('sensor.humidity_leuven24_wunderground')}}%)."
      title: Sluit het raam van de master bedroom!
      data:
        color: blue
        channel: Vocht
        timeout: 3600
        tag: vocht_master_bedroom
        actions:
        - action: URI
          title: Meer info
          uri: /lovelace/humidity
  mode: single
- id: 'Vocht in kamer Alunya - open raam (Bart)'
  alias: ðŸ’§ Vocht in kamer Alunya - open raam (Bart)
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /15
  condition:
  - condition: template
    value_template: '{{ states(''sensor.kamer_alunya_humidity'') | float > 60 }}'
  - condition: template
    value_template: '{{ states(''sensor.humidity_leuven24_wunderground'') | float
      < 80 }}'
  - condition: zone
    entity_id: person.bart
    zone: zone.home
  - condition: time
    after: '7:0:0'
    before: '23:00:00'
  - condition: state
    entity_id: binary_sensor.alunya_raam_sensor
    state: 'off'
  - condition: state
    entity_id: binary_sensor.alunya_schuifraam_sensor
    state: 'off'
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.kamer_alunya_raam_moet_open    
  - service: notify.mobile_app_bart_s10
    data:
      message: "Vocht in kamer Alunya: {{states('sensor.kamer_alunya_humidity')}}%. Buiten: {{states('sensor.humidity_leuven24_wunderground')}}%."
      title: Open het raam van kamer Alunya!
      data:
        color: blue
        actions:
        - action: URI
          title: Meer info
          uri: /lovelace/humidity
        channel: Vocht
        timeout: 3600
        tag: vocht_kamer_alunya
  mode: single
- id: 'Vocht in kamer Alunya - open raam (Madouce)'
  alias: ðŸ’§ Vocht in kamer Alunya - open raam (Madouce)
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /15
  condition:
  - condition: template
    value_template: '{{ states(''sensor.kamer_alunya_humidity'') | float > 60 }}'
  - condition: template
    value_template: '{{ states(''sensor.humidity_leuven24_wunderground'') | float
      < 80 }}'
  - condition: zone
    entity_id: person.madouce
    zone: zone.home
  - condition: time
    after: '7:0:0'
    before: '23:00:00'
  - condition: state
    entity_id: binary_sensor.alunya_raam_sensor
    state: 'off'
  - condition: state
    entity_id: binary_sensor.alunya_schuifraam_sensor
    state: 'off'
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.kamer_alunya_raam_moet_open  
  - service: notify.mobile_app_madouce_s20
    data:
      message: "Vocht in kamer Alunya: {{states('sensor.kamer_alunya_humidity')}}%. Buiten: {{states('sensor.humidity_leuven24_wunderground')}}%."
      title: Open het raam van kamer Alunya!
      data:
        color: blue
        actions:
        - action: URI
          title: Meer info
          uri: /lovelace/humidity
        vibrationPattern: 10, 10, 10, 10, 10, 10, 10
        channel: Vocht
        timeout: 3600
        tag: vocht_kamer_alunya
  mode: single
- id: 'Vocht in veranda - open raam (Bart)'
  alias: ðŸ’§ Vocht in veranda - open raam (Bart)
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /15
  condition:
  - condition: template
    value_template: "{{ states('sensor.veranda_humidity') | float > 60 }}"
  - condition: template
    value_template: "{{ states('sensor.humidity_leuven24_wunderground') | float < 80 }}"
  - condition: template
    value_template: "{{ states('sensor.veranda_humidity') > states('sensor.humidity_leuven24_wunderground') }}"
  - condition: zone
    entity_id: person.bart
    zone: zone.home
  - condition: time
    after: '7:0:0'
    before: '23:00:00'
  - condition: state
    entity_id: binary_sensor.veranda_schuifraam_sensor
    state: 'off'
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.veranda_schuifraam_moet_open  
  - service: notify.mobile_app_bart_s10
    data:
      message: "In veranda vochtiger ({{states('sensor.veranda_humidity')}}%) dan buiten ({{states('sensor.humidity_leuven24_wunderground')}}%)."
      title: Open het raam van de veranda!
      data:
        color: blue
        channel: Vocht
        timeout: 3600
        tag: vocht_veranda
        actions:
        - action: URI
          title: Meer info
          uri: /lovelace/humidity
  mode: single
- id: 'Vocht buiten >80% ramen dicht (Bart)'
  alias: ðŸ’§vocht buiten >80% = melding ramen dicht (Bart)
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.humidity_leuven24_wunderground
    above: '80'
    for: 00:05:00
  condition:
  - condition: zone
    entity_id: person.bart
    zone: zone.home
  - condition: time
    after: '7:00:00'
  action:
  - service: notify.mobile_app_bart_s10
    data:
      message: ðŸ’§ Vochtigheidsgraad buiten is {{states('sensor.humidity_leuven24_wunderground')}}%.
        Sluit alle ramen aub.
      title: '{{ ["Ramen mogen dicht.", "Beetje te vochtig, ramen dicht doen ...",
        "Het wordt nu te vochtig buiten..."] | random }}'
      data:
        color: blue
        actions:
        - action: URI
          title: Meer info
          uri: /lovelace/humidity
        vibrationPattern: 100, 1000, 100, 1000, 100
        channel: Vocht
        timeout: 3600
        tag: vocht
  mode: single
- id: 'Vocht buiten >80% ramen dicht (Madouce)'
  alias: ðŸ’§vocht buiten >80% = melding ramen dicht (Madouce)
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.humidity_leuven24_wunderground
    above: '80'
    for: 00:05:00
  condition:
  - condition: zone
    entity_id: person.madouce
    zone: zone.home
  - condition: time
    after: '7:00:00'
  action:
  - service: notify.mobile_app_madouce_s20
    data:
      message: "ðŸ’§ Vochtigheidsgraad buiten is {{states('sensor.humidity_leuven24_wunderground')}}%. Sluit alle ramen aub."
      title: '{{ ["Ramen mogen dicht.", "Beetje te vochtig, ramen dicht doen ...", "Het wordt nu te vochtig buiten..."] | random }}'
      data:
        color: blue
        actions:
        - action: URI
          title: Meer info
          uri: /lovelace/humidity
        vibrationPattern: 100, 1000, 100, 1000, 100
        channel: Vocht
        timeout: 3600
        tag: vocht
  mode: single
- id: "Vocht in huis >75%"
  alias: ðŸ’§ Vocht in huis >75%
  description: ''
  trigger:
    - platform: numeric_state
      entity_id: sensor.avg_inside_humidity
      above: '75'
      for: '00:15'
  condition:
    - condition: state
      entity_id: person.bart
      state: home
    - condition: time
      after: '7:0:0'
      before: '23:00:00'
  action:
    - service: notify.mobile_app_bart_s10
      data:
        title: Vocht
        message: 'Vocht % in huis is heel hoog: {{states(''sensor.avg_inside_humidity'')}}.'
  mode: single
- id: "vocht % stijgt in Eikenbos + master bedroom (Bart)"
  alias: vocht % stijgt in Eikenbos + master bedroom = melding
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.humidity_eikenbos_rising
    to: 'on'
  condition:
    - condition: state
      entity_id: person.bart
      state: home
    - condition: time
      after: '7:0:0'
      before: '23:00:00'
    - condition: state
      entity_id: binary_sensor.humidity_master_bedroom_rising
      state: 'on'
    - condition: state
      entity_id: binary_sensor.master_bedroom_raam_sensor
      state: 'on'
  action:
  - service: notify.mobile_app_bart_s10
    data:
      title: Vocht in Eikenbos
      message: "Vocht % stijgt in master bedroom en buiten {{states(''sensor.humidity_leuven24_wunderground'')}}%)."
  mode: single
- id: "vocht % stijgt in Eikenbos + kamer Alunya (Bart)"
  alias: vocht % stijgt in Eikenbos + kamer Alunya = melding
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.humidity_eikenbos_rising
    to: 'on'
  condition:
    - condition: state
      entity_id: person.bart
      state: home
    - condition: time
      after: '7:0:0'
      before: '23:00:00'
    - condition: state
      entity_id: binary_sensor.alunya_raam_sensor
      state: 'on'
  action:
  - service: notify.mobile_app_bart_s10
    data:
      title: Vocht in kamer Alunya
      message: "Vocht stijgt in kamer Alunya ({{states(''sensor.kamer_alunya_humidity'')}}% en buiten ({{states(''sensor.humidity_leuven24_wunderground'')}}%)."
  mode: single
- id: "vocht stijgt in master bedroom"
  alias: vocht % stijgt in master bedroom = melding
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.humidity_master_bedroom_rising
    to: 'on'
  condition:
    - condition: state
      entity_id: person.bart
      state: home
    - condition: time
      after: '7:0:0'
      before: '23:00:00'
    - condition: state
      entity_id: binary_sensor.master_bedroom_raam_sensor
      state: 'on'
  action:
  - service: notify.mobile_app_bart_s10
    data:
      title: Vocht in master bedroom
      message: "Vocht stijgt in master bedroom ({{states(''sensor.master_bedroom_humidity'')}}% en buiten ({{states(''sensor.humidity_leuven24_wunderground'')}}%)."
  mode: single
- id: 'Vocht master bedroom machine aan'
  alias: ðŸ’§ vocht master bedroom -> machine aan
  description: ''
  trigger:
  - platform: time
    at: '20:30'
  condition:
  - condition: numeric_state
    entity_id: sensor.master_bedroom_humidity
    above: '75'
  - condition: numeric_state
    entity_id: sensor.humidity_leuven24_wunderground
    above: '75'
  action:
  - service: notify.mobile_app_bart_s10
    data:
      message: "Master bedroom vocht is {{states('sensor.master_bedroom_humidity')}}%. Zet eventueel machine aan."
      title: Zet ontvochtiger in master bedroom.
      data:
        color: blue
        channel: Vocht
        actions:
        - action: URI
          title: Meer info
          uri: /lovelace/humidity
  mode: single

# raam wordt geopend

- id: "Master bedroom raam werd geopend (Bart)"
  alias: ðŸ’§ Master bedroom raam werd geopend (Bart)
  description: ''
  trigger:
    - platform: state
      entity_id: binary_sensor.master_bedroom_raam_sensor
      from: 'off'
      to: 'on'
  condition:
    - condition: state
      entity_id: input_boolean.master_bedroom_raam_moet_open
      state: 'on'
    - condition: zone
      entity_id: person.bart
      zone: zone.home
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.master_bedroom_raam_moet_open  
  - service: notify.mobile_app_bart_s10
    data:
      message: "In master bedroom {{states('sensor.master_bedroom_humidity')}}%. Buiten {{states('sensor.humidity_leuven24_wunderground')}}%."
      title: Bedankt om master bedroom raam te openen!
      data:
        color: blue
        channel: Vocht
        timeout: 300
        tag: vocht_master_bedroom
        actions:
        - action: URI
          title: Meer info
          uri: /lovelace/humidity
  mode: single
- id: "Master bedroom raam werd geopend (Madouce)"
  alias: ðŸ’§ Master bedroom raam werd geopend (Madouce)
  description: ''
  trigger:
    - platform: state
      entity_id: binary_sensor.master_bedroom_raam_sensor
      from: 'off'
      to: 'on'
  condition:
    - condition: state
      entity_id: input_boolean.master_bedroom_raam_moet_open
      state: 'on'
    - condition: zone
      entity_id: person.madouce
      zone: zone.home
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.master_bedroom_raam_moet_open  
  - service: notify.mobile_app_madouce_s20
    data:
      message: "In master bedroom {{states('sensor.master_bedroom_humidity')}}%. Buiten {{states('sensor.humidity_leuven24_wunderground')}}%."
      title: Bedankt om master bedroom raam te openen!
      data:
        color: blue
        channel: Vocht
        timeout: 300
        tag: vocht_master_bedroom
        actions:
        - action: URI
          title: Meer info
          uri: /lovelace/humidity
  mode: single
- id: "Veranda schuifraam werd geopend (Bart)"
  alias: ðŸ’§ Veranda schuifraam werd geopend (Bart)
  description: ''
  trigger:
    - platform: state
      entity_id: binary_sensor.veranda_schuifraam_sensor
      from: 'off'
      to: 'on'
  condition:
    - condition: state
      entity_id: input_boolean.veranda_schuifraam_moet_open
      state: 'on'
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.veranda_schuifraam_moet_open  
  - service: notify.mobile_app_bart_s10
    data:
      message: "In veranda {{states('sensor.veranda_humidity')}}%. Buiten {{states('sensor.humidity_leuven24_wunderground')}}%."
      title: Bedankt om veranda schuifdeur te openen!
      data:
        color: blue
        channel: Vocht
        timeout: 300
        tag: vocht_veranda
        actions:
        - action: URI
          title: Meer info
          uri: /lovelace/humidity
  mode: single
- id: "Kamer Alunya raam werd geopend (Bart)"
  alias: ðŸ’§ Kamer Alunya raam werd geopend (Bart)
  description: ''
  trigger:
    - platform: state
      entity_id: binary_sensor.kamer_alunya_raam_sensor
      from: 'off'
      to: 'on'
  condition:
    - condition: state
      entity_id: input_boolean.kamer_alunya_raam_moet_open
      state: 'on'
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.kamer_alunya_raam_moet_open  
  - service: notify.mobile_app_bart_s10
    data:
      message: "In kamer Alunya {{states('sensor.kamer_alunya_humidity')}}%. Buiten {{states('sensor.humidity_leuven24_wunderground')}}%."
      title: Bedankt om kamer Alunya raam te openen!
      data:
        color: blue
        channel: Vocht
        timeout: 300
        tag: vocht_kamer_alunya
        actions:
        - action: URI
          title: Meer info
          uri: /lovelace/humidity
  mode: single

#######################
# Actions
#######################

- id: 'master_bedroom_humidity_pause2h'
  alias: ðŸ’§ master_bedroom_humidity_pause2h
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: master_bedroom_humidity_pause2h
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.master_bedroom_humidity_pause2h  
  
- id: "zet pauze toggle master bedroom naar OFF na 2 uren"  
  alias: "ðŸ’§ zet pauze toggle master bedroom naar OFF na 2 uren"
  description: 'zet pauze toggle master bedroom naar OFF na 2 uren'
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.master_bedroom_humidity_pause2h
      to: 'on'
#     for: '02:00:00'
  condition: []
  action:
    - wait_template: '2:00:00'
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.master_bedroom_humidity_pause2h
        
- id: "zet pauze toggle master bedroom naar OFF (geforceerd)"  
  alias: "ðŸ’§ zet pauze toggle master bedroom naar OFF (geforceerd)"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.master_bedroom_humidity_pause2h
      to: 'off'
  condition: []
  action:
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.master_bedroom_humidity_pause2h

- id: "middernacht = reset schakelaars"
  alias: "ðŸ’§ middernacht = reset schakelaars"
  description: reset booleans voor openzetten ramen ivm vocht
  trigger:
    - platform: time
      at: '00:00'
  condition: []
  action:
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.veranda_schuifraam_moet_open
          - input_boolean.master_bedroom_raam_moet_open
          - input_boolean.master_bedroom_humidity_pause2h
  mode: single
