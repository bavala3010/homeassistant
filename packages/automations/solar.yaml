automation:

- alias: update van zonneproductie gisteren op dit uur
  id: "6f18655a-e923-46b5-9a83-8d3340458e83"  
  description: ""
  trigger:
    - platform: time_pattern
      minutes: /10
  condition: []
  action:
    - service: homeassistant.update_entity
      data: {}
      target:
        entity_id: sensor.zonneproductie_gisteren_op_dit_uur
  mode: single
 

- alias: snelle polling sensoren berekening verbruik
  id: '92e4e452-ebb1-4db1-9b6a-0c1566a40b0c'
  description: ''
  trigger:
  - platform: time_pattern
    seconds: /30
  condition: []
  action:
  - service: homeassistant.update_entity
    target:
      entity_id:
      - sensor.solar_power
      - sensor.huisverbruik
      - sensor.net_power
  mode: single

- alias: injectie meer dan 2,5 kW = melding dat auto kan worden geladen
  id: '2d15d773-5a7f-4c83-ab27-fceef60120ae'
  description: ""
  mode: single
  trigger:
    - platform: numeric_state
      entity_id: sensor.net_power
      for:
        hours: 0
        minutes: 10
        seconds: 0
      below: "-2500"
  condition: []
  action:
    - service: notify.bart_phone
      data:
        title: Gebruik de zonne-energie verstandig
        message: >
          Nu {{ states('sensor.net_power') | float | round(0) | abs }} W injectie in het net.<br>
          Eventueel auto laden? Auto nu {{states('sensor.car_1_soc') | round()}}%.<br>
          Vandaag moet er geladen worden tot {{states('input_number.car_charge_target_percentage') | round() }}%.
    - service: notify.madouce_phone
      data:
        title: Gebruik de zonne-energie verstandig
        message: >
          Nu {{ states('sensor.net_power') | float | round(0) | abs }} W injectie in het net.<br>
          Eventueel auto laden? Auto nu {{states('sensor.car_1_soc') | round()}}%.<br>
          Vandaag moet er geladen worden tot {{states('input_number.car_charge_target_percentage') | round() }}%.

- alias: Meer dan 3 kW verbruik van het net = melding
  id: '518c0b8f-2031-49cc-bbac-210b2728df07'
  description: ""
  mode: single
  trigger:
    - platform: numeric_state
      entity_id: sensor.net_power
      for:
        hours: 0
        minutes: 5
        seconds: 0
      above: "3000"
  condition: []
  action:
    - service: notify.bart_phone
      data:
        title: Hoog energieverbruik
        message: "Er wordt nu {{ states('sensor.net_power') }} kW verbruikt van het net."
        data:
          notification_icon: "mdi:lightning-bolt"
          color: red
          actions:
          - action: URI
            title: meer info
            uri: /lovelace-verbruik/zonne-energie

- alias: "solar // einde van de zonne-energie productie voor vandaag"
  id: '9a576f40-1363-466d-bab3-915845c02e49'
  description: ''
  trigger:
    - platform: numeric_state
      entity_id: sensor.solar_power
      for:
        hours: 0
        minutes: 10
        seconds: 0
      below: "1"
  condition: []
  action:
    - service: notify.bart_phone
      data:
        title: Zonne-energie
        message: "Vandaag heeft de zon {{ states('sensor.sma_today') }} kWh opgebracht."
        data: 
          notification_icon: mdi:sun-wireless-outline
  mode: single

- alias: solar // bewaar zonneproductie van vandaag
  id: "e1f01cf4-6cca-4cdc-81ff-372f65eabffd"  
  description: ""
  trigger:
    - platform: time
      at: "23:45:00"
  condition: []
  action:
  - service: input_number.set_value
    data: {}
    target:
      entity_id: input_number.solar_production_endofday
    data:
      value: "{{ states('sensor.sma_today') }}"
  mode: single 