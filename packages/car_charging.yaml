############################ Table of Contents ############################ 
# 
#   Automations
#


# bluetooth address Etron: 98:49:14:C1:37:0B
# VIN etron: WAUZZZGE6MB019131

############################ Automations ################################## 
automation:
 

######################################
# gewoon laden (niet thuis)
######################################

- alias: ðŸš— autolader is verbonden (niet thuis) = melding
  id: 'cdd4783a-a810-4b0a-b46d-1b1bf58eb80e'
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.audi_e_tron_sportback_plug_state
    to: 'connected'
  condition:
  - condition: template
    value_template: "{{ states('device_tracker.audi_e_tron_sportback_position') != 'home' }}"
  action:
  - service: notify.bart_phone
    data:
      title: "ðŸš™ Autolader is verbonden." 
      message: "Nu {{states('sensor.audi_e_tron_sportback_state_of_charge')}}%. Nog {{states('sensor.audi_e_tron_sportback_remaining_charge_time')}} laden."
      data:
        color: green
        tag: auto_laden
        timeout: 300
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron        
  - service: notify.madouce_phone
    data:
      message: "ðŸš™ Autolader is verbonden. Nu {{states('sensor.audi_e_tron_sportback_state_of_charge')}}%."
      data:
        color: green
        tag: auto_laden
        timeout: 300
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron        
  mode: single

- alias: ðŸš— auto laadt (niet thuis) = melding
  id: '10f06a54-7eea-4d86-9bf8-2ef07549a4d6'
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.audi_e_tron_sportback_charging_state
    from: 'off'
    to: 'charging'
  condition:
  - condition: template
    value_template: "{{ states('device_tracker.audi_e_tron_sportback_position') != 'home' }}"
  action:
  - service: notify.bart_phone
    data:
      title: ðŸš™ Auto is aan het laden.
      message: Nu {{states('sensor.audi_e_tron_sportback_state_of_charge')}}% = {{states('sensor.audi_e_tron_sportback_primary_engine_range')}} km.
        Nog {{states('sensor.audi_e_tron_sportback_remaining_charge_time')}} laden.
      data:
        color: green
        tag: auto_laden
        timeout: 300
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - service: notify.madouce_phone
    data:
      message: Nu {{states('sensor.audi_e_tron_sportback_state_of_charge')}}% = {{states('sensor.audi_e_tron_sportback_primary_engine_range')}} km.
        Nog {{states('sensor.audi_e_tron_sportback_remaining_charge_time')}} laden.
      data:
        color: green
        tag: auto_laden
        timeout: 300
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  mode: single

- alias: ðŸš— auto gedaan met laden (niet thuis) = melding
  id: '23ebfe4a-e944-49dc-aa3f-e8a1983e8a56'
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.audi_e_tron_sportback_charging_state
    to: 'completed'
  condition: []
  action:
  - service: notify.bart_phone
    data:
      message: "ðŸš™ Auto heeft gedaan met laden. Nu {{states('sensor.audi_e_tron_sportback_state_of_charge')}}%. {{states('sensor.audi_e_tron_sportback_primary_engine_range')}} km."
      data:
        color: green
        tag: auto_laden
        timeout: 43200
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  - service: notify.madouce_phone
    data:
      message: "ðŸš™ Auto heeft gedaan met laden. Nu {{states('sensor.audi_e_tron_sportback_state_of_charge')}}%. {{states('sensor.audi_e_tron_sportback_primary_engine_range')}} km."
      data:
        color: green
        tag: auto_laden
        timeout: 43200
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/e-tron
  mode: single


#######################################
# Check lading 's avonds
######################################
  
- alias: ðŸš— morgen naar Toyota Evere = check 21u30 voldoende geladen?
  id: 'e03b771a-c1d0-49ed-a0d7-8e833e3c228e'
  description: ''
  trigger:
  - platform: time
    at: '21:30:00'  
  condition:
  - condition: template
    value_template: >
      {% set car_use_day = 'input_select.car_use_day' ~ (now().isoweekday() +1) %}
      {%if states(car_use_day) == "Toyota Evere"%} true {% endif %}
  action:
  - service: notify.madouce_phone
    data:
      title: Morgen naar Toyota Evere
      message: "Nu {{states('sensor.audi_e_tron_sportback_state_of_charge')}}%. {% if states('sensor.audi_e_tron_sportback_state_of_charge') |round() > 24 %}Voldoende batterijniveau.{% else %} Onvoldoende geladen. Best 20% Ã  25%.{% endif %}"
  - service: notify.bart_phone
    data:
      title: Morgen naar Toyota Evere
      message: "Nu {{states('sensor.audi_e_tron_sportback_state_of_charge')}}%. {% if states('sensor.audi_e_tron_sportback_state_of_charge') |round() > 24 %}Voldoende batterijniveau.{% else %} Onvoldoende geladen. Best 20% Ã  25%.{% endif %}"
  mode: single
  
- alias: ðŸš— morgen naar Toyota Diest = check 21u30 voldoende geladen?
  id: 'dfb0156e-1033-4259-82d0-08c5bc687860'
  description: ''
  trigger:
  - platform: time
    at: '21:30:00'  
  condition:
  - condition: template
    value_template: >
      {% set car_use_day = 'input_select.car_use_day' ~ (now().isoweekday() +1) %}
      {%if states(car_use_day) == "Toyota Diest"%} true {% endif %}
  action:
  - service: notify.madouce_phone
    data:
      title: Morgen naar Toyota Diest
      message: "Nu {{states('sensor.audi_e_tron_sportback_state_of_charge')}}%. {% if states('sensor.audi_e_tron_sportback_state_of_charge') |round() > 38 %}Voldoende batterijniveau.{% else %} Onvoldoende geladen. Best +/- 40%.{% endif %}"
  - service: notify.bart_phone
    data:
      title: Morgen naar Toyota Diest
      message: "Nu {{states('sensor.audi_e_tron_sportback_state_of_charge')}}%. {% if states('sensor.audi_e_tron_sportback_state_of_charge') |round() > 38 %}Voldoende batterijniveau.{% else %} Onvoldoende geladen. Best +/- 40%.{% endif %}"
  mode: single

- alias: ðŸš— batterij <60% en niet verbonden (week)
  id: '19c7cda6-2abb-4e28-9025-0ea5c4e1caa1'
  description: ''
  trigger:
  - platform: time
    at: '21:30'
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - sun
  - condition: template
    value_template: "{% if states('sensor.audi_e_tron_sportback_state_of_charge') | float < 60.0 %} true {% endif %}"
  - condition: state
    entity_id: device_tracker.audi_e_tron_sportback_position
    state: home
  - condition: state
    entity_id: sensor.audi_e_tron_sportback_plug_state
    state: disconnected
  action:
  - service: notify.bart_phone
    data:
      title: Auto laden?
      message: "ðŸš™ Auto maar {{states('sensor.audi_e_tron_sportback_state_of_charge')}}% = {{states('sensor.audi_e_tron_sportback_primary_engine_range')}} km."
      data:
        color: green
        tag: auto_laden
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/car-charging      
  - service: notify.madouce_phone
    data:
      title: Auto laden?
      message: "ðŸš™ Auto maar {{states('sensor.audi_e_tron_sportback_state_of_charge')}}% = {{states('sensor.audi_e_tron_sportback_primary_engine_range')}} km."
      data:
        color: green
        tag: auto_laden
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/car-charging
  mode: single

- alias: ðŸš— batterij <80% en niet verbonden (weekend)
  id: '30ea35b4-3f2a-4702-9df4-323965d8bf70'
  description: ''
  trigger:
  - platform: time
    at: '21:45'
  condition:
  - condition: time
    weekday:
    - fri
    - sat
  - condition: template
    value_template: "{% if states('sensor.audi_e_tron_sportback_state_of_charge') | float < 80.0 %} true {% endif %}"
  - condition: state
    entity_id: device_tracker.audi_e_tron_sportback_position
    state: home
  - condition: state
    entity_id: sensor.audi_e_tron_sportback_plug_state
    state: disconnected
  action:
  - service: notify.bart_phone
    data:
      title: Auto laden voor het weekend?
      message: "ðŸš™ Auto maar {{states('sensor.audi_e_tron_sportback_state_of_charge')}}% = {{states('sensor.audi_e_tron_sportback_primary_engine_range')}} km."
      data:
        color: green
        tag: auto_laden
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/car-charging
  - service: notify.madouce_phone
    data:
      title: Auto laden voor het weekend?
      message: "ðŸš™ Auto maar {{states('sensor.audi_e_tron_sportback_state_of_charge')}}% = {{states('sensor.audi_e_tron_sportback_primary_engine_range')}} km."
      data:
        color: green
        tag: auto_laden
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/car-charging        
  mode: single


#######################################
# Charging modus toggle
######################################

- alias: "ðŸ”‹ smart charging - toggle charging mode"
  id: '49d1aea0-e3b2-4a80-83ba-b2d68d3a3e22'
  trigger:
  - platform: state
    entity_id: input_boolean.smart_charging_mode_timer
  - platform: state
    entity_id: input_boolean.smart_charging_mode_direct
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.smart_charging_mode_timer
        state: 'on'
      sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.smart_charging_mode_direct
      - service: script.auto_start_laden_timer
        data: {}
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.car_smart_charging_busy
    - conditions:
      - condition: state
        entity_id: input_boolean.smart_charging_mode_direct
        state: 'on'
      sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.smart_charging_mode_timer
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.car_smart_charging_busy
      - service: script.auto_start_laden_nu
        data: {}       
  mode: restart


#######################################
# Target range / SOC
######################################

- alias: charging target percentage veranderd
  id: 'bc9713f6-225f-4e87-99eb-6bb78aa18653'
  description: ''
  trigger:
  - platform: state
    entity_id: input_number.car_smart_charging_target_percentage
  condition: []
  action:
  - service: input_number.set_value
    target:
      entity_id: input_number.car_smart_charging_target_range
    data:
      value: "{{ ((states('input_number.car_smart_charging_target_percentage') | float ) * (states('sensor.car_range_per_10percent')| float) / 10) | int }}"
  - wait_template: ''
    timeout: '00:00:02'      
  mode: single

- alias: charging target range veranderd
  id: '79d535f9-0b79-4eb6-98cb-5786bf032300'
  description: ''
  trigger:
  - platform: state
    entity_id: input_number.car_smart_charging_target_range
  condition: []
  action:
  - service: input_number.set_value
    target:
      entity_id: input_number.car_smart_charging_target_percentage
    data:
      value: "{{ ((states('input_number.car_smart_charging_target_range') | float ) / (states('sensor.car_range_per_10percent')| float) * 10) | int }}"
  - wait_template: ''
    timeout: '00:00:02'  
  mode: single

######################################
# car smart charging (enkel thuis)
######################################

- alias: "ðŸ”‹ smart charging - om 10u, 20u en 22u check of laadkabel ingeplugd is voor smart charging binnen de volgende 10 uren "
  id: '995d850b-435f-46a6-9e5a-9ab89701ddf4'
  description: ''
  trigger:
  - platform: time
    at: '10:00'
  - platform: time
    at: '20:00'
  - platform: time
    at: '22:00'
  condition:
  - condition: state
    entity_id: device_tracker.audi_e_tron_sportback_position
    state: home    
  - condition: state
    entity_id: sensor.audi_e_tron_sportback_plug_state
    state: 'disconnected'
  # voorwaarde: als start tijd < nu + 10 uren (dus starttijd voor 20u)
  - condition: template
    value_template: "{% if as_timestamp(states('sensor.car_smart_charging_start_time')) | timestamp_custom('%Y-%m-%d %H:%M', false) < ((as_timestamp(now())  + (10 * 60 * 60)) | timestamp_custom('%Y-%m-%d %H:%M')) %}true{% endif %}"
  action:
  - service: notify.bart_phone
    data:
      title: "Plug de laadkabel in."
      message: "De auto zou moeten laden op {{ as_timestamp(states('sensor.car_smart_charging_start_time')) | timestamp_custom('%a %-Hu%M', false) }} maar de kabel steekt niet in. Laaddoel is {{ states('input_number.car_smart_charging_target_percentage') | round() }}%."
      data:
        tag: smart_charging
        color: green
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/car-charging        
  mode: single

- alias: "ðŸ”‹ smart charging - laadkabel zopas ingeplugd = op timer zetten (enkel thuis)"
  # bij het inpluggen begint de lader eerst bijna 2 minuten direct te laden want het duurt een tijdje vooraleer het commando om op timer te laden geactiveerd wordt
  id: '6fc148ce-a035-4699-bffd-dc4eb83e52a5'
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.audi_e_tron_sportback_plug_state
    to: connected
  condition:
    # check dat de auto thuis staat
  - condition: state
    entity_id: device_tracker.audi_e_tron_sportback_position
    state: home
    # check dat de sessie op de laadpaal gestart is
  - condition: state
    entity_id: sensor.chargepoint_status
    state: connected
  action:
  - service: notify.bart_phone
    data:
      title: "Smart charging staat nu klaar."
      message: >
         De laadkabel is zopas ingeplugd.<br>
         Smart charging van {{ as_timestamp(states('sensor.car_smart_charging_start_time')) | timestamp_custom('%a %-Hu%M', false)}} tot {{ state_attr('input_datetime.car_smart_charging_target_time', 'timestamp') | timestamp_custom("%a %-Hu%M") }}.<br>
         Er wordt geladen van {{states('sensor.audi_e_tron_sportback_state_of_charge') | round() }}% naar {{states('input_number.car_smart_charging_target_percentage') | round() }}%.
      data:
        tag: smart_charging
        color: green
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/car-charging
  - service: notify.madouce_phone
    data:
      title: "Smart charging staat nu klaar."
      message: >
         De laadkabel is zopas ingeplugd.<br>
         Smart charging van {{ as_timestamp(states('sensor.car_smart_charging_start_time')) | timestamp_custom('%a %-Hu%M', false)}} tot {{ state_attr('input_datetime.car_smart_charging_target_time', 'timestamp') | timestamp_custom("%a %-Hu%M") }}.<br>
         Er wordt geladen van {{states('sensor.audi_e_tron_sportback_state_of_charge') | round() }}% naar {{states('input_number.car_smart_charging_target_percentage') | round() }}%.
      data:
        tag: smart_charging
        color: green
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/car-charging        
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_timed_charger
  mode: single    

- alias: "ðŸ”‹ smart charging - laadkabel verbonden maar sessie op laadpaal niet gestart"
  id: '8add47e4-3af1-43f9-b9f3-56e39c333e1e'
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.audi_e_tron_sportback_plug_state
    to: connected
  condition:
  - condition: state
    entity_id: sensor.chargepoint_status
    state: 'available'
    for:
      hours: 0
      minutes: 1
      seconds: 0
  action:
  - service: notify.bart_phone
    data:
      message: TTS
      title: "De laadkabel steekt in, maar de sessie is niet gestart!"
      data:
        channel: alarm_stream
  - service: notify.bart_phone
    data:
      title: "De laadkabel steekt in maar de sessie is niet gestart."
      message: >
         De laadkabel is ingeplugd maar er is niet gebadget om de sessie te starten.
      data:
        tag: smart_charging
        color: green
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/car-charging        
  mode: single

- alias: "ðŸ”‹ smart charging - starten op datum en uur van smart charging start time"
  id: '7bcf7836-3149-4eb2-9d40-f0f3f309a249'
  description: ''
  trigger:
  - platform: template
    value_template: "{% if as_timestamp(states('sensor.car_smart_charging_start_time')) | timestamp_custom('%Y-%m-%d %H:%M',false)  == as_timestamp(now()) | timestamp_custom('%Y-%m-%d %H:%M') %}true{% endif %}"
  # Only run routine if smart charging has not yet started (input_boolean.car_smart_charging_busy = off)
  # Because the calculated start time continuously moves while charging, this routine would continously be triggered
  condition:
  - condition: state
    entity_id: input_boolean.smart_charging_mode_timer
    state: 'on'
  - condition: state
    entity_id: input_boolean.car_smart_charging_busy
    state: 'off'
  - condition: state
    entity_id: sensor.audi_e_tron_sportback_charging_state
    state: 'off'
  action:
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.car_smart_charging_busy  
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_charger
  - service: notify.bart_phone
    data:
      title: Smart charging gestart.
      message: "Nu: {{states('sensor.audi_e_tron_sportback_state_of_charge') | round()}}%. Laden tot {{states('input_number.car_smart_charging_target_percentage') | round() }}%.<br>Doeluur: {{as_timestamp(states('input_datetime.car_smart_charging_target_time')) | timestamp_custom('%a %-d/%-m %-Hu%M',false) }}"
      data:
        tag: smart_charging
        color: green
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/car-charging
  mode: single

- alias: "ðŸ”‹ smart charging - direct laden gestart"
  id: '242e4f5f-1396-4774-911a-be6e7b685c82'
  trigger:
  - platform: state
    entity_id: input_boolean.smart_charging_mode_direct
    to: 'on'
  condition: []
  action:
  - service: notify.bart_phone
    data:
      title: Direct laden gestart.
      message: >
        {% set target = states('input_number.car_smart_charging_target_percentage') | float(default=0) %}
        {% set soc = states('sensor.audi_e_tron_sportback_state_of_charge') | float(default=0) %}
        {% set nog_te_laden_procent = [target - soc, 0] | max %}
        {% set nog_te_laden_minuten = nog_te_laden_procent * 8.5 | round(2) %}      
        Nu: {{states('sensor.audi_e_tron_sportback_state_of_charge') | round()}}%.
        Laden tot {{states('input_number.car_smart_charging_target_percentage') | round() }}%.<br>
        Laden gedaan op {{ (as_timestamp(now()) + (nog_te_laden_minuten | float(default=0) * 60)) | timestamp_custom('%a %d %b %-Hu%M') }}
      data:
        tag: smart_charging
        color: green
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/car-charging
  mode: single

- alias: "ðŸ”‹ smart charging - laaddoel bereikt (zowel timer als direct)= laden stoppen + melding sturen + timer dag later (enkel thuis)"
  id: 'b7a22897-2c7b-4e07-bf71-380271658908'
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.audi_e_tron_sportback_state_of_charge
  condition:
  - condition: template
    value_template: "{{ states('sensor.audi_e_tron_sportback_state_of_charge')| int(2) >= (states('input_number.car_smart_charging_target_percentage') | int(2)) }}"
  - condition: state
    entity_id: sensor.audi_e_tron_sportback_charging_state
    state: 'charging'
  - condition: state
    entity_id: device_tracker.audi_e_tron_sportback_position
    state: home    
  action:
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.car_smart_charging_busy
  - service: notify.bart_phone
    data:
      title: Laaddoel bereikt!
      message: "Laaddoel van {{states('input_number.car_smart_charging_target_percentage') | round() }}% is bereikt. Huidige lading: {{states('sensor.audi_e_tron_sportback_state_of_charge') | round()}}%"
      data:
        tag: smart_charging
        color: green
        actions:
        - action: URI
          title: meer info
          uri: /eikenbos-dashboard/car-charging        
  # targtet time op dag later zetten
  - service: input_datetime.set_datetime
    data:
      datetime: "{{ (as_timestamp(now())  + (24 * 60 * 60) ) | timestamp_custom('%Y-%m-%d %H:%M:%S') }}"
    target:
      entity_id: input_datetime.car_smart_charging_target_time
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_timed_charger
  mode: single
  
- alias: "ðŸ”‹ smart charging - red hours: week 6u-8u -> lader op timer (enkel thuis)"
  id: '0a0bce79-42d8-4184-9dab-9ed54f30f3bf'  
  description: ''
  trigger:
  - platform: time
    at: 06:00
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: state
    entity_id: device_tracker.audi_e_tron_sportback_position
    state: home    
  action:
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_timed_charger
  - delay: 02:00:00
  - condition: state
    entity_id: input_boolean.car_smart_charging_busy
    state: 'on'  
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_charger
  mode: single
  
- alias: "ðŸ”‹ smart charging - red hours: zaterdag 7u-9u -> lader op timer (enkel thuis)"
  id: '31e6ff24-3423-4332-b4f9-da785af82b26'
  description: ''
  trigger:
  - platform: time
    at: 07:00
  condition:
  - condition: time
    weekday:
    - sat
  - condition: state
    entity_id: device_tracker.audi_e_tron_sportback_position
    state: home    
  action:
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_timed_charger
  - delay: 02:00:00
  - condition: state
    entity_id: input_boolean.car_smart_charging_busy
    state: 'on'
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_charger
  mode: single

- alias: "ðŸ”‹ smart charging - red hours: zondag 8u-12u -> lader op timer (enkel thuis)"
  id: '81cb1458-debb-4378-9313-d34f4029f693'
  description: ''
  trigger:
  - platform: time
    at: 08:00
  condition:
  - condition: time
    weekday:
    - sun
  - condition: state
    entity_id: device_tracker.audi_e_tron_sportback_position
    state: home    
  action:
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_timed_charger
  - delay: 04:00:00
  - service: audiconnect.execute_vehicle_action
    data:
      vin: WAUZZZGE6MB019131
      action: start_charger
  mode: single

- alias: "ðŸ”‹ smart charging - laaddoeluur bereikt = verzetten naar 's anderendaags"
  id: '94c89ef0-a331-4a74-a2bc-d03289b73354'
  description: ''
  trigger:
  - platform: template
    value_template: "{% if as_timestamp(states('input_datetime.car_smart_charging_target_time')) | timestamp_custom('%Y-%m-%d %H:%M',false) == as_timestamp(now()) | timestamp_custom('%Y-%m-%d %H:%M') %}true{% endif %}"
  condition: []
  action:
  - service: input_datetime.set_datetime
    data:
      datetime: "{{ (as_timestamp(now())  + (24 * 60 * 60) ) | timestamp_custom('%Y-%m-%d %H:%M:%S') }}"
    target:
      entity_id: input_datetime.car_smart_charging_target_time
  mode: single
  

#######################################
# Laadpaal / car charger
######################################

- alias: '[elek] Set the chargepoint current'
  id: '246e66e7-ce8f-4078-9f18-2ca23225e5cd'
  description: 'Pass MQTT current to the script'
  trigger:
    - platform: mqtt
      topic: chargepoint/maxcurrent
  condition: []
  action:
    - service: script.set_modbus_maxcurrent
      data_template:
        value_msb: '{{ trigger.payload_json.value_msb | int}}'
        value_lsb: '{{ trigger.payload_json.value_lsb | int}}'
  mode: single

